<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Mopclass;
use App\Models\Mopcompetition;
use App\Models\Mopcompetitor;
use App\Models\Moporganization;
use App\Models\Online;
use App\Models\Telegram;
use App\Models\Telegram_log;

class TelegramController extends Controller
{
    public function message(Request $request)
    {
        Telegram_log::info($request->all());
        $site_dir = dirname(dirname(__FILE__)) . '/'; // ÐºÐ¾Ñ€ÐµÐ½ÑŒ ÑÐ°Ð¹Ñ‚Ð°
        $data = file_get_contents('php://input'); // Ð²ÐµÑÑŒ Ð²Ð²Ð¾Ð´ Ð¿ÐµÑ€ÐµÐ½Ð°Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð² $data
        $data = json_decode($data, true); // Ð´ÐµÐºÐ¾Ð´Ð¸Ñ€ÑƒÐµÐ¼ json-Ð·Ð°ÐºÐ¾Ð´Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ðµ-Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² PHP-Ð¼Ð°ÑÑÐ¸Ð²
        $bot_token = '2107045715:AAFH4DLnTFuxLCTxZ17FGLj0hHCbNbAbOm8'; // Ñ‚Ð¾ÐºÐµÐ½ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð±Ð¾Ñ‚Ð°
        file_put_contents(__DIR__ . '/message.txt', print_r($data, true));
        if (!empty($request->message['text'])) {
            $chat_id = $request->message['from']['id'];
            $user_name = $request->message['from']['username'];
            $first_name = $request->message['from']['first_name'];
            $last_name = $request->message['from']['last_name'];
            $text = trim($request->message['text']);
            $text_array = explode(" ", $text);
            $bot_state = self::get_bot_state($chat_id);

            if (substr($bot_state, 0, 6) == '/name') { // ÐµÑÐ»Ð¸ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ° Ð·Ð°ÑÐ²ÐºÐ¸, Ñ‚Ð¾ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ð¼ Ð·Ð°ÑÐ²ÐºÑƒ Ð¼ÐµÐ½ÐµÐ´Ð¶ÐµÑ€Ñƒ ÐºÐ¾Ð¼Ð¿Ð°Ð½Ð¸Ð¸ Ð½Ð° $order_chat_id
                $text_return = 
$text . " Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ð¹ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ. Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚Ð¸ Ñ‰Ðµ ÐºÐ¾Ð³Ð¾ÑÑŒ, Ð¿ÐµÑ€ÐµÐ¹Ð´Ñ–Ñ‚ÑŒ /name. ðŸ“
ÐŸÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð²ÐµÑÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ð¼Ð¾Ð¶Ð½Ð° Ñ‚ÑƒÑ‚ /list_name. ðŸ‘€

Ð—Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ /name Ð²Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð´Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ñ– Ñ–Ð¼ÐµÐ½Ð° Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ. Ð¦Ðµ Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ð±Ð¾Ñ‚Ñƒ Event_O Ð½Ð°Ð´ÑÐ¸Ð»Ð°Ñ‚Ð¸ Ð²Ð°Ð¼ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð· Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼Ð¸ Ñ‚Ð° Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½ÑÐ¼Ð¸ Ð¿Ñ€Ð¾ Ð¾Ð±Ñ€Ð°Ð½Ñ– ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ¸ Ð°Ð±Ð¾ Ð¿Ð¾Ð´Ñ–Ñ—. Ð’Ð°Ð¼ Ð½Ðµ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð¿Ñ€Ð¾Ð¿ÑƒÑÐºÐ°Ñ‚Ð¸ Ð¶Ð¾Ð´Ð½Ñƒ Ð²Ð°Ð¶Ð»Ð¸Ð²Ñƒ Ð¿Ð¾Ð´Ñ–ÑŽ Ð°Ð±Ð¾ Ð´Ð¾ÑÑÐ³Ð½ÐµÐ½Ð½Ñ, Ð¾ÑÐºÑ–Ð»ÑŒÐºÐ¸ Ð±Ð¾Ñ‚ Ð±ÑƒÐ´Ðµ ÑÑ‚ÐµÐ¶Ð¸Ñ‚Ð¸ Ð·Ð° Ð²Ð°Ð¼Ð¸. ðŸš€

ÐÐµ ÑÐ¾Ñ€Ð¾Ð¼Ñ‚ÐµÑÑ Ð´Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ð±Ñ–Ð»ÑŒÑˆÐµ Ñ–Ð¼ÐµÐ½ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ. Ð¦Ðµ Ð±ÐµÐ·Ð¿ÐµÑ‡Ð½Ð¸Ð¹ ÑÐ¿Ð¾ÑÑ–Ð± Ð±ÑƒÑ‚Ð¸ Ð² ÐºÑƒÑ€ÑÑ– Ð²ÑÑŒÐ¾Ð³Ð¾, Ñ‰Ð¾ Ð²Ð°Ñ Ñ†Ñ–ÐºÐ°Ð²Ð¸Ñ‚ÑŒ. ÐŸÑ€Ð¾ÑÑ‚Ð¾ Ð²Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ñ–Ð¼'Ñ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ° Ñ‚Ð° Ð½Ð°Ð´Ñ–ÑˆÐ»Ñ–Ñ‚ÑŒ Ð¹Ð¾Ð³Ð¾ Ð±Ð¾Ñ‚Ñƒ, Ñ– Ð²Ñ–Ð½ Ð´Ð¾Ð´Ð°ÑÑ‚ÑŒ Ð¹Ð¾Ð³Ð¾ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ. ðŸ˜Š

ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ /list_name. Ð’Ð¸ Ð·Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð²ÑÑ–Ñ… Ð´Ð¾Ð´Ð°Ð½Ð¸Ñ… ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ð°Ð±Ð¾ Ð¿Ð¾Ð´Ñ–Ñ— Ñ– Ð²Ð¿ÐµÐ²Ð½Ð¸Ñ‚Ð¸ÑÑ, Ñ‰Ð¾ Ð²Ð°Ñˆ ÑÐ¿Ð¸ÑÐ¾Ðº Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¸Ð¹. ðŸ‘¥

Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ð¼Ð°Ñ”Ñ‚Ðµ ÑÐºÑ–-Ð½ÐµÐ±ÑƒÐ´ÑŒ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ, Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /help, Ñ‰Ð¾Ð± Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñƒ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ñƒ. ðŸ¤”ðŸ’¡";


                self::message_to_telegram($bot_token, $chat_id, $text_return);
                self::add_name_table($user_name, $text, $chat_id);
                self::set_bot_state($chat_id, '/help'); // Ð½Ðµ Ð·Ð°Ð±ÑƒÐ´ÐµÐ¼ Ð¿Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ñ‚Ñƒ, Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð·Ð°ÑÐ²ÐºÐ¸
            } 
            
            
            elseif (substr($bot_state, 0, 6) == '/delet') {
                $text_return = "
âœ… Ð’Ð¸ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾ Ð²Ð¸Ð´Ð°Ð»Ð¸Ð»Ð¸ $text Ð·Ñ– ÑÐ²Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ.

Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ð±Ð°Ð¶Ð°Ñ”Ñ‚Ðµ Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ Ñ‰Ðµ ÐºÐ¾Ð³Ð¾ÑÑŒ Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ, ÑÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹Ñ‚ÐµÑÑ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾ÑŽ /delet.

ðŸ“‹ Ð”Ð»Ñ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ´Ñƒ Ð¿Ð¾Ð²Ð½Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /list_name.

ðŸ¤” ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð° Ð°Ð±Ð¾ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ? Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /help. ðŸ˜ŠðŸ‘";
                self::message_to_telegram($bot_token, $chat_id, $text_return);
                Telegram::where('name', $text)->where('user_id', $chat_id)->delete();
                self::set_bot_state($chat_id, '/help'); // Ð½Ðµ Ð·Ð°Ð±ÑƒÐ´ÐµÐ¼ Ð¿Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ñ‚Ñƒ, Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð·Ð°ÑÐ²ÐºÐ¸
            } 
            
            
            
            elseif (substr($bot_state, 0, 10) == '/all_delet') {
                $text_return = "
âœ… Ð’Ð¸ ÑƒÑÐ¿Ñ–ÑˆÐ½Ð¾ Ð²Ð¸Ð´Ð°Ð»Ð¸Ð»Ð¸ Ð²ÑÑ–Ñ… ÑÐ¿Ð¾Ñ€Ñ‚ÑÐ¼ÐµÐ½Ñ–Ð² Ð·Ñ– ÑÐ²Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ.

Ð¢ÐµÐ¿ÐµÑ€ Ð²Ð°Ñˆ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ð¿Ð¾Ñ€Ð¾Ð¶Ð½Ñ–Ð¹. Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ð±Ð°Ð¶Ð°Ñ”Ñ‚Ðµ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ñƒ Ð»ÑŽÐ´Ð¸Ð½Ñƒ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ, ÑÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹Ñ‚ÐµÑÑ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾ÑŽ /name.

ðŸ“ Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ ÐŸÑ€Ñ–Ð·Ð²Ð¸Ñ‰Ðµ Ð†Ð¼'Ñ, ÑÐºÐµ Ð²Ð¸ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ, Ñ‚Ð° Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ñ‚Ðµ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ.

ðŸ“‹ ÐŸÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð²ÐµÑÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ð¼Ð¾Ð¶Ð½Ð° ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾ÑŽ /list_name.

ðŸ¤” ÐŸÐ¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð° Ð°Ð±Ð¾ Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ? Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /help. ðŸ˜ŠðŸ‘";
                self::message_to_telegram($bot_token, $chat_id, $text_return);
                Telegram::where('user_id', $chat_id)->delete();
                self::set_bot_state($chat_id, '/help'); // Ð½Ðµ Ð·Ð°Ð±ÑƒÐ´ÐµÐ¼ Ð¿Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚ÑŒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð½Ð° Ð¿ÑƒÑÑ‚Ð¾Ñ‚Ñƒ, Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð·Ð°ÑÐ²ÐºÐ¸
            } 
            
            
            
            else {
                if ($text == '/start') {
                    $text_return = "
ÐŸÑ€Ð¸Ð²Ñ–Ñ‚, $first_name $last_name! Ð›Ð°ÑÐºÐ°Ð²Ð¾ Ð¿Ñ€Ð¾ÑÐ¸Ð¼Ð¾ Ð´Ð¾ Ð±Ð¾Ñ‚Ð° Event_O! ðŸ¤–âœ¨

Ð¦Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– Ð´Ð»Ñ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½Ñ:
                    
/help - Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´ ðŸ“šâ“
/about - Ð´Ñ–Ð·Ð½Ð°Ñ‚Ð¸ÑÑ Ð±Ñ–Ð»ÑŒÑˆÐµ Ð¿Ñ€Ð¾ Ð±Ð¾Ñ‚Ð° Event_O â„¹ï¸ðŸ¤–
/name - Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ðµ Ñ–Ð¼'Ñ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ âž•ðŸ‘¤
/list_name - Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð²ÐµÑÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ ðŸ‘¥ðŸ“‹
                    
Ð—Ð°Ð¿Ð°Ð¼'ÑÑ‚Ð°Ð¹Ñ‚Ðµ, Ð±Ð¾Ñ‚ Event_O Ð·Ð°Ð²Ð¶Ð´Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ñ‚Ð¸ Ð²Ð°Ð¼ Ð· Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½ÑÐ¼ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ñ— Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ— Ñ‰Ð¾Ð´Ð¾ Ð¿Ð¾Ð´Ñ–Ð¹ Ñ‚Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð². ðŸ“ðŸ’¡
                    
Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ñ” Ð±ÑƒÐ´ÑŒ-ÑÐºÑ– Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð° Ð² Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ–Ð¹ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼Ñ†Ñ–, Ð½Ðµ ÑÐ¾Ñ€Ð¾Ð¼Ñ‚ÐµÑÑ Ð·Ð²ÐµÑ€Ñ‚Ð°Ñ‚Ð¸ÑÑ Ð´Ð¾ Ð¼ÐµÐ½Ðµ. ðŸ˜ŠðŸ‘‹
                    
Ð‘Ð°Ð¶Ð°Ñ”Ð¼Ð¾ Ð²Ð°Ð¼ Ð¿Ñ€Ð¸Ñ”Ð¼Ð½Ð¾Ð³Ð¾ ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ð½Ð½Ñ Ð±Ð¾Ñ‚Ð¾Ð¼ Event_O Ñ‚Ð° ÑƒÑÐ¿Ñ–Ñ…Ñ–Ð² Ñƒ Ð²ÑÑ–Ñ… Ð²Ð°ÑˆÑ–Ñ… Ð¿Ð¾Ð´Ñ–ÑÑ…! ðŸŽ‰ðŸŒŸ";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/help');
                } 
                
                
                
                elseif ($text == '/about') {
                    $text_return = "
ðŸ¤– ÐÐ°Ð·Ð²Ð°: Event_O
ðŸ“š ÐžÐ¿Ð¸Ñ: Event_O - Ñ†Ðµ Ñ‚ÐµÐ»ÐµÐ³Ñ€Ð°Ð¼-Ð±Ð¾Ñ‚, ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð² Ð¿Ð¾Ð´Ñ–Ð¹ Ñ– Ð·Ð¼Ð°Ð³Ð°Ð½ÑŒ. Ð’Ñ–Ð½ Ð´Ð¾Ð¿Ð¾Ð¼Ð°Ð³Ð°Ñ” ÐºÐ¾Ñ€Ð¸ÑÑ‚ÑƒÐ²Ð°Ñ‡Ð°Ð¼ Ð±ÑƒÑ‚Ð¸ Ð² ÐºÑƒÑ€ÑÑ– Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½ÑŒ Ñ‚Ð° Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ Ð¿Ñ€Ð¾ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ñ‚Ð° Ñ—Ñ… Ð´Ð¾ÑÑÐ³Ð½ÐµÐ½Ð½Ñ.
ðŸ’¡ Ð¤ÑƒÐ½ÐºÑ†Ñ–Ð¾Ð½Ð°Ð»: Ð‘Ð¾Ñ‚ Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ” Ð´Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ñ–Ð¼ÐµÐ½Ð° ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ, Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ²Ð°Ñ‚Ð¸ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ Ð¿Ñ€Ð¾ Ñ—Ñ… Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ñ‚Ð° Ð¼Ñ–ÑÑ†Ðµ Ð² Ð·Ð¼Ð°Ð³Ð°Ð½Ð½ÑÑ…. ÐšÑ€Ñ–Ð¼ Ñ‚Ð¾Ð³Ð¾, Ð²Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²ÑÑ–Ñ… Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð¸Ñ… Ñ–Ð¼ÐµÐ½ Ñ– Ð·Ñ€ÑƒÑ‡Ð½Ð¾ ÐºÐµÑ€ÑƒÐ²Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ.
âœ… ÐšÐ¾Ð¼Ð°Ð½Ð´Ð¸:
/help - Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ‚Ð° Ñ—Ñ… Ð¾Ð¿Ð¸Ñ.
/name - Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ðµ Ñ–Ð¼'Ñ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ.
/list_name - Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð¸Ñ… Ñ–Ð¼ÐµÐ½.

ÐÐµ ÑÐ¾Ñ€Ð¾Ð¼Ñ‚ÐµÑÑ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ Ð±Ð¾Ñ‚Ð° Event_O Ð´Ð»Ñ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð² Ñ‚Ð° Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾Ñ— Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ— Ð¿Ñ€Ð¾ Ð²Ð°ÑˆÑ– ÑƒÐ»ÑŽÐ±Ð»ÐµÐ½Ñ– Ð¿Ð¾Ð´Ñ–Ñ—. Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ð²Ð¸Ð½Ð¸ÐºÐ½ÑƒÑ‚ÑŒ Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ, Ð·Ð²ÐµÑ€Ñ‚Ð°Ð¹Ñ‚ÐµÑÑ Ð´Ð¾ Ð±Ð¾Ñ‚Ð° - Ñ Ð·Ð°Ð²Ð¶Ð´Ð¸ Ð³Ð¾Ñ‚Ð¾Ð²Ð¸Ð¹ Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ñ‚Ð¸ Ð²Ð°Ð¼! ðŸ¤—ðŸ†";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/about');
                } 
                
                
                
                
                elseif ($text == '/help') {
                    $text_return = "
ÐŸÑ€Ð¸Ð²Ñ–Ñ‚, $first_name $last_name! Ð¯ - Ð±Ð¾Ñ‚ Event_O, ÑÐºÐ¸Ð¹ ÑÑ‚Ð²Ð¾Ñ€ÐµÐ½Ð¸Ð¹ Ð´Ð»Ñ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð² Ð¿Ð¾Ð´Ñ–Ð¹ Ñ– Ð·Ð¼Ð°Ð³Ð°Ð½ÑŒ. Ð”Ð¾Ð·Ð²Ð¾Ð»ÑŒÑ‚Ðµ Ð¼ÐµÐ½Ñ– Ñ€Ð¾Ð·Ð¿Ð¾Ð²Ñ–ÑÑ‚Ð¸ Ð²Ð°Ð¼ Ð¿Ñ€Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸:

/help - Ñ†Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð½Ð°Ð´Ð°ÑÑ‚ÑŒ Ð²Ð°Ð¼ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´ Ñ– ÐºÐ¾Ñ€Ð¾Ñ‚ÐºÐ¸Ð¹ Ð¾Ð¿Ð¸Ñ Ñ—Ñ… Ñ„ÑƒÐ½ÐºÑ†Ñ–Ð¾Ð½Ð°Ð»Ñƒ. Ð’Ð¸ Ð·Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð»ÐµÐ³ÐºÐ¾ Ð¾Ð·Ð½Ð°Ð¹Ð¾Ð¼Ð¸Ñ‚Ð¸ÑÑ Ð· Ð¼Ð¾Ð¶Ð»Ð¸Ð²Ð¾ÑÑ‚ÑÐ¼Ð¸ Ð±Ð¾Ñ‚Ð°. ðŸ˜ŠðŸ“š
                    
/about - Ñ†Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð¾Ð·Ð²Ð¾Ð»Ð¸Ñ‚ÑŒ Ð²Ð°Ð¼ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ñ‚Ð¸ Ð¾Ð³Ð»ÑÐ´ Ð¿Ñ€Ð¾ Ð±Ð¾Ñ‚Ð° Event_O. Ð’Ð¸ Ð´Ñ–Ð·Ð½Ð°Ñ”Ñ‚ÐµÑÑŒ Ð¿Ñ€Ð¾ Ð¹Ð¾Ð³Ð¾ Ð¿Ñ€Ð¸Ð·Ð½Ð°Ñ‡ÐµÐ½Ð½Ñ, Ð¾ÑÐ½Ð¾Ð²Ð½Ñ– Ñ„ÑƒÐ½ÐºÑ†Ñ–Ñ— Ñ‚Ð° Ñ‚Ðµ, ÑÐº Ñ Ð¼Ð¾Ð¶Ñƒ Ð±ÑƒÑ‚Ð¸ Ð²Ð°Ð¼ ÐºÐ¾Ñ€Ð¸ÑÐ½Ð¸Ð¼. ðŸ¤–ðŸ’¡
                    
/name - Ñ†Ñ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð´Ð¾Ð·Ð²Ð¾Ð»ÑÑ” Ð²Ð°Ð¼ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ð½Ð¾Ð²Ðµ Ñ–Ð¼'Ñ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ. Ð¯ Ð±ÑƒÐ´Ñƒ Ð²Ñ–Ð´ÑÐ»Ñ–Ð´ÐºÐ¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ð´Ð»Ñ Ð²ÐºÐ°Ð·Ð°Ð½Ð¾Ñ— Ð¾ÑÐ¾Ð±Ð¸ Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÑÑ‚Ð¸ Ð²Ð°Ñ Ð¿Ñ€Ð¾ Ñ—Ñ… Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ. ðŸ“âœ…
                    
/list_name - Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ Ñ†ÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ, Ñ‰Ð¾Ð± Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ Ð¿Ð¾Ð²Ð½Ð¸Ð¹ ÑÐ¿Ð¸ÑÐ¾Ðº Ñ–Ð¼ÐµÐ½, ÑÐºÑ– Ñ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÑŽ. Ð’Ð¸ Ð·Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð±Ð°Ñ‡Ð¸Ñ‚Ð¸ Ð²ÑÑ– Ð´Ð¾Ð´Ð°Ð½Ñ– Ñ–Ð¼ÐµÐ½Ð° Ñ– Ð±ÑƒÑ‚Ð¸ Ð² ÐºÑƒÑ€ÑÑ– Ñ—Ñ… Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð². ðŸ“‹ðŸ‘€
                    
ÐÐµ ÑÐ¾Ñ€Ð¾Ð¼Ñ‚ÐµÑÑ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ²Ð°Ñ‚Ð¸ Ñ†Ñ– ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ Ð´Ð»Ñ Ð¾Ñ‚Ñ€Ð¸Ð¼Ð°Ð½Ð½Ñ Ð½ÐµÐ¾Ð±Ñ…Ñ–Ð´Ð½Ð¾Ñ— Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ— Ñ‚Ð° ÐºÐµÑ€ÑƒÐ²Ð°Ð½Ð½Ñ ÑÐ¿Ð¸ÑÐºÐ¾Ð¼ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ.
                    
Ð¯ Ð·Ð°Ð²Ð¶Ð´Ð¸ Ñ‚ÑƒÑ‚, Ñ‰Ð¾Ð± Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ñ‚Ð¸ Ð²Ð°Ð¼ Ð· Ð±ÑƒÐ´ÑŒ-ÑÐºÐ¸Ð¼Ð¸ Ð·Ð°Ð¿Ð¸Ñ‚Ð°Ð½Ð½ÑÐ¼Ð¸ Ð°Ð±Ð¾ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±Ð¾ÑŽ Ð² Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ñ–Ð¹ Ð¿Ñ–Ð´Ñ‚Ñ€Ð¸Ð¼Ñ†Ñ–. Ð—Ð²ÐµÑ€Ñ‚Ð°Ð¹Ñ‚ÐµÑÑŒ Ð´Ð¾ Ð±Ð¾Ñ‚Ð° Event_O Ñ– Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ¹Ñ‚Ðµ Ð·Ñ€ÑƒÑ‡Ð½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ Ð¿Ñ€Ð¾ Ð²Ð°ÑˆÑ– ÑƒÐ»ÑŽÐ±Ð»ÐµÐ½Ñ– Ð¿Ð¾Ð´Ñ–Ñ—! ðŸ˜ŠðŸ¤–";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/about');
                } 
                
                
                
                
                elseif ($text == '/name') {
                    $text_return = "
$first_name $last_name, Ð´Ð»Ñ Ñ‚Ð¾Ð³Ð¾ Ñ‰Ð¾Ð± Ð´Ð¾Ð´Ð°Ñ‚Ð¸ Ñ–Ð¼ÐµÐ½Ð°, Ð·Ð° ÑÐºÐ¸Ð¼Ð¸ Ð²Ð¸ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ ÑÐ»Ñ–Ð´ÐºÑƒÐ²Ð°Ñ‚Ð¸, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÑ–Ñ‚ÑŒ 'ÐŸÑ€Ñ–Ð·Ð²Ð¸Ñ‰Ðµ Ð†Ð¼Ñ' Ñ– Ð²Ñ–Ð´Ð¿Ñ€Ð°Ð²Ñ‚Ðµ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ. ðŸ“

ÐÐ°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´, ÑÐºÑ‰Ð¾ Ð²Ð¸ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ Ð´Ð¾Ð´Ð°Ñ‚Ð¸ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ° Ð· Ñ–Ð¼ÐµÐ½ÐµÐ¼ Ð†Ð²Ð°Ð½ ÐŸÐµÑ‚Ñ€Ð¾Ð², Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð½Ð°Ð¿Ð¸ÑˆÑ–Ñ‚ÑŒ 'ÐŸÐµÑ‚Ñ€Ð¾Ð² Ð†Ð²Ð°Ð½' Ñ– Ð½Ð°Ð´Ñ–ÑˆÐ»Ñ–Ñ‚ÑŒ Ð¹Ð¾Ð³Ð¾ Ð±Ð¾Ñ‚Ñƒ. ðŸ§‘â€ðŸ’»

Ð‘Ð¾Ñ‚ Event_O Ð±ÑƒÐ´Ðµ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ñ‚Ð¸ Ñ†Ðµ Ñ–Ð¼'Ñ Ñ– Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÑÑ‚Ð¸ Ð²Ð°Ñ Ð¿Ñ€Ð¾ Ð±ÑƒÐ´ÑŒ-ÑÐºÑ– Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ Ð°Ð±Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸, Ð¿Ð¾Ð²'ÑÐ·Ð°Ð½Ñ– Ð· Ñ†Ð¸Ð¼ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ¾Ð¼. Ð’Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð´Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ð±Ð°Ð³Ð°Ñ‚Ð¾ Ñ–Ð¼ÐµÐ½, ÑÐºÑ– Ð²Ð°Ñ Ñ†Ñ–ÐºÐ°Ð²Ð»ÑÑ‚ÑŒ. ÐÐµ Ð·Ð°Ð±ÑƒÐ´ÑŒÑ‚Ðµ, Ñ‰Ð¾ Ð²Ð¸ Ð·Ð°Ð²Ð¶Ð´Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ³Ð»ÑÐ½ÑƒÑ‚Ð¸ ÑÐ¿Ð¸ÑÐ¾Ðº Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ Ð·Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð¾ÑŽ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¸ /list_name. ðŸ‘¥

Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ð²Ð¸Ð½Ð¸ÐºÐ»Ð¸ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð²Ð°Ð¼ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð°, ÑÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹Ñ‚ÐµÑÑ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾ÑŽ /help. ðŸ¤”ðŸ’¡

ÐÐ°ÑÐ¾Ð»Ð¾Ð´Ð¶ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð½Ð½ÑÐ¼ Ð±Ð¾Ñ‚Ñƒ Event_O Ñ– Ð¾Ñ‚Ñ€Ð¸Ð¼ÑƒÐ¹Ñ‚Ðµ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñƒ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–ÑŽ Ð¿Ñ€Ð¾ Ð²Ð°ÑˆÑ– ÑƒÐ»ÑŽÐ±Ð»ÐµÐ½Ñ– Ð¿Ð¾Ð´Ñ–Ñ— Ñ‚Ð° ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð²! ðŸš€âœ¨";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/name');
                } 
                
                
                
                
                elseif ($text == '/list_name') {
                    $spisocs = Telegram::where('user_id', $chat_id)->get();
                    $count = $spisocs->count();
                    $spis = " ";
                    foreach ($spisocs as $spisoc) {
                        $spis = "$spis ($spisoc->name)";
                    }
                   $text_return = "
Ð£ Ð²Ð°ÑˆÐ¾Ð¼Ñƒ ÑÐ¿Ð¸ÑÐºÑƒ Ð·Ð°Ñ€Ð°Ð· Ð·Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÑŒÑÑ $count Ð»ÑŽÐ´Ð¸Ð½Ð¸: 

$spis

Ð©Ð¾Ð± Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ ÐºÐ¾Ð³Ð¾ÑÑŒ Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ, Ð½Ð°Ñ‚Ð¸ÑÐ½Ñ–Ñ‚ÑŒ /delet.

Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ð±Ð°Ð¶Ð°Ñ”Ñ‚Ðµ Ð¾Ñ‡Ð¸ÑÑ‚Ð¸Ñ‚Ð¸ Ð²ÐµÑÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº, ÑÐºÐ¾Ñ€Ð¸ÑÑ‚Ð°Ð¹Ñ‚ÐµÑÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾ÑŽ /all_delet.

ðŸ‘¥ Ð’Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð´Ð¾Ð´Ð°Ð²Ð°Ñ‚Ð¸ Ð°Ð±Ð¾ Ð²Ð¸Ð´Ð°Ð»ÑÑ‚Ð¸ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ñƒ Ð±ÑƒÐ´ÑŒ-ÑÐºÐ¸Ð¹ Ñ‡Ð°Ñ, Ñ‰Ð¾Ð± Ð·Ð°Ð±ÐµÐ·Ð¿ÐµÑ‡Ð¸Ñ‚Ð¸ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ñ–ÑÑ‚ÑŒ Ð²Ð°ÑˆÐ¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÑƒÐ²Ð°Ð½Ð½Ñ. Ð”Ð¾Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ²Ð¾Ñ—Ñ… ÑƒÐ»ÑŽÐ±Ð»ÐµÐ½Ð¸Ñ… ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ñ– Ð·Ð°Ð»Ð¸ÑˆÐ°Ð¹Ñ‚ÐµÑÑŒ Ð² ÐºÑƒÑ€ÑÑ– Ñ—Ñ…Ð½Ñ–Ñ… Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð² Ñ‚Ð° Ð¿Ð¾Ð´Ñ–Ð¹! ðŸƒâ€â™€ï¸ðŸ’¨

Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ð²Ð¸Ð½Ð¸ÐºÐ»Ð¸ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð°, Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /help. ðŸ¤”ðŸ’¡

Ð’Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ Ð±Ð¾Ñ‚Ð° Event_O Ð· Ð·Ð°Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½Ð½ÑÐ¼ Ñ‚Ð° Ð½Ð°ÑÐ¾Ð»Ð¾Ð´Ð¶ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð°ÐºÑ‚ÑƒÐ°Ð»ÑŒÐ½Ð¾ÑŽ Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ”ÑŽ Ð¿Ñ€Ð¾ Ð²Ð°ÑˆÑ– ÑƒÐ»ÑŽÐ±Ð»ÐµÐ½Ñ– Ð¿Ð¾Ð´Ñ–Ñ— Ñ‚Ð° ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð²! ðŸš€âœ¨";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/list_name');
                } 
                
                
                
                
                elseif ($text == '/delet') {
                    $text_return = "
Ð’Ð²ÐµÐ´Ñ–Ñ‚ÑŒ Ð¿Ñ€Ñ–Ð·Ð²Ð¸Ñ‰Ðµ Ñ‚Ð° Ñ–Ð¼'Ñ, ÑÐºÐµ Ð²Ð¸ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ, Ñ– Ð½Ð°Ð´Ñ–ÑˆÐ»Ñ–Ñ‚ÑŒ Ð¿Ð¾Ð²Ñ–Ð´Ð¾Ð¼Ð»ÐµÐ½Ð½Ñ.

ðŸ—‘ï¸ Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ð±Ð°Ð¶Ð°Ñ”Ñ‚Ðµ Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ° Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ, Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð²ÐºÐ°Ð¶Ñ–Ñ‚ÑŒ Ð¹Ð¾Ð³Ð¾ Ð¿Ð¾Ð²Ð½Ðµ Ñ–Ð¼'Ñ, Ð½Ð°Ð¿Ñ€Ð¸ÐºÐ»Ð°Ð´: ÐŸÑ€Ñ–Ð·Ð²Ð¸Ñ‰Ðµ Ð†Ð¼'Ñ.

ðŸ“ Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ñ” Ð±Ð°Ð³Ð°Ñ‚Ð¾ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ñƒ ÑÐ¿Ð¸ÑÐºÑƒ, Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾ÑÐ»Ñ–Ð´Ð¾Ð²Ð½Ð¾ Ð²Ð¸Ð´Ð°Ð»ÑÑ‚Ð¸ Ñ—Ñ… Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ð·Ð° Ð¾Ð´Ð½Ð¸Ð¼. Ð’Ð¸ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð²Ð¸Ð´Ð°Ð»ÑÑ‚Ð¸ Ð±Ð°Ð¶Ð°Ð½Ñƒ ÐºÑ–Ð»ÑŒÐºÑ–ÑÑ‚ÑŒ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² Ð·Ð° Ð¾Ð´Ð¸Ð½ Ñ€Ð°Ð·.

â—ï¸ Ð—Ð²ÐµÑ€Ð½Ñ–Ñ‚ÑŒ ÑƒÐ²Ð°Ð³Ñƒ, Ñ‰Ð¾ Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÐ° Ð·Ñ– ÑÐ¿Ð¸ÑÐºÑƒ Ð¿Ñ€Ð¸Ð·Ð²ÐµÐ´Ðµ Ð´Ð¾ Ð²Ñ–Ð´ÑÑƒÑ‚Ð½Ð¾ÑÑ‚Ñ– Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ Ð¹Ð¾Ð³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñ–Ð² Ñ‚Ð° Ð¿Ð¾Ð´Ñ–Ð¹.

Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ð²Ð¸Ð½Ð¸ÐºÐ»Ð¸ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð°, Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /help. ðŸ¤”ðŸ’¡";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/delet');
                } 
                
                
                
                
                elseif ($text == '/all_delet') {
                    $text_return = "
Ð’Ð¸ Ð²Ð¿ÐµÐ²Ð½ÐµÐ½Ñ–, Ñ‰Ð¾ Ñ…Ð¾Ñ‡ÐµÑ‚Ðµ Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ ÑƒÑÑ–Ñ… ÑÐ¿Ð¾Ñ€Ñ‚ÑÐ¼ÐµÐ½Ñ–Ð² Ð·Ñ– ÑÐ²Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ?

ðŸ—‘ï¸ Ð¦Ñ Ð´Ñ–Ñ Ð¿Ñ€Ð¸Ð·Ð²ÐµÐ´Ðµ Ð´Ð¾ Ð¿Ð¾Ð²Ð½Ð¾Ð³Ð¾ Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ Ð²ÑÑ–Ñ… ÑÐ¿Ð¾Ñ€Ñ‚ÑÐ¼ÐµÐ½Ñ–Ð², ÑÐºÑ– Ð²Ð¸ Ð´Ð¾Ð´Ð°Ð»Ð¸ Ð´Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ Ð²Ñ–Ð´ÑÑ‚ÐµÐ¶ÐµÐ½Ð½Ñ. Ð£ÑÑ– Ñ—Ñ…Ð½Ñ– Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Ñ‚Ð° Ñ–Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ñ–Ñ Ð±ÑƒÐ´ÑƒÑ‚ÑŒ Ð²Ñ‚Ñ€Ð°Ñ‡ÐµÐ½Ñ–.

Ð¯ÐºÑ‰Ð¾ Ð²Ð¸ Ð¿ÐµÐ²Ð½Ñ– Ñƒ ÑÐ²Ð¾Ñ”Ð¼Ñƒ Ñ€Ñ–ÑˆÐµÐ½Ð½Ñ–, Ð²Ð¸Ð±ÐµÑ€Ñ–Ñ‚ÑŒ Ð¾Ð´Ð½Ñƒ Ð· Ð½Ð°ÑÑ‚ÑƒÐ¿Ð½Ð¸Ñ… Ð¾Ð¿Ñ†Ñ–Ð¹:

/yes_delet_all - Ð¿Ñ–Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ð¸ Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ ÑƒÑÑ–Ñ… ÑÐ¿Ð¾Ñ€Ñ‚ÑÐ¼ÐµÐ½Ñ–Ð².
/no_delet_all - Ð²Ñ–Ð´Ð¼Ñ–Ð½Ð¸Ñ‚Ð¸ Ð²Ð¸Ð´Ð°Ð»ÐµÐ½Ð½Ñ Ñ‚Ð° Ð·Ð°Ð»Ð¸ÑˆÐ¸Ñ‚Ð¸ ÑÐ¿Ð¸ÑÐºÐ¾Ðº Ð±ÐµÐ· Ð·Ð¼Ñ–Ð½.
â—ï¸ Ð—Ð²ÐµÑ€Ð½Ñ–Ñ‚ÑŒ ÑƒÐ²Ð°Ð³Ñƒ, Ñ‰Ð¾ Ñ†Ñ Ð´Ñ–Ñ Ð½ÐµÐ¾Ð±Ð¾Ñ€Ð¾Ñ‚Ð½Ð° Ñ– Ð½Ðµ Ð¼Ð¾Ð¶Ðµ Ð±ÑƒÑ‚Ð¸ ÑÐºÐ°ÑÐ¾Ð²Ð°Ð½Ð°. ÐŸÐµÑ€ÐµÐºÐ¾Ð½Ð°Ð¹Ñ‚ÐµÑÑ, Ñ‰Ð¾ Ð²Ð¸ Ð´Ñ–Ð¹ÑÐ½Ð¾ Ð±Ð°Ð¶Ð°Ñ”Ñ‚Ðµ Ð²Ð¸Ð´Ð°Ð»Ð¸Ñ‚Ð¸ Ð²ÑÑ–Ñ… ÑÐ¿Ð¾Ñ€Ñ‚ÑÐ¼ÐµÐ½Ñ–Ð² Ð·Ñ– ÑÐ²Ð¾Ð³Ð¾ ÑÐ¿Ð¸ÑÐºÑƒ.

Ð¯ÐºÑ‰Ð¾ Ñƒ Ð²Ð°Ñ Ð²Ð¸Ð½Ð¸ÐºÐ»Ð¸ Ð¿Ð¸Ñ‚Ð°Ð½Ð½Ñ Ð°Ð±Ð¾ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð° Ð´Ð¾Ð´Ð°Ñ‚ÐºÐ¾Ð²Ð° Ð´Ð¾Ð¿Ð¾Ð¼Ð¾Ð³Ð°, Ð²Ð¸ÐºÐ¾Ñ€Ð¸ÑÑ‚Ð¾Ð²ÑƒÐ¹Ñ‚Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñƒ /help. ðŸ¤”ðŸ’¡";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/all_delet');
                }
            }
        }
    }


    public function search2($event_id, $pass, $time, $status)
    {
        $online = Online::where('id', $event_id)->first();
        if ($online->cod == $pass) {
            $dani['stat'] = $status;
            $dani['pass'] = $pass;
            $dani['id'] = $event_id;
            $dani['time'] = $time;


            $token = '2107045715:AAFH4DLnTFuxLCTxZ17FGLj0hHCbNbAbOm8';

            $grups = Mopclass::where('cid', $event_id)->get();
            $event = Mopcompetition::where('cid', $event_id)->first();
            $clubs = Moporganization::where('cid', $event_id)->get();

            
            if ($status=='start') {
                $peopless = Mopcompetitor::where('cid', $event_id)->where('st', '>', 0)->get(); // Ð²Ð¸Ð¹Ð¼Ð°Ñ”Ð¼Ð¾ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² ÑÐºÑ– Ñ„Ñ–Ð½Ñ–ÑˆÑƒÐ²Ð°Ð»Ð¸ 30 Ñ…Ð² Ð½Ð°Ð·Ð°Ð´
            }
            if ($status=='go') {
                $peopless = Mopcompetitor::where('cid', $event_id)->where('rt', '>', 0)->get(); // Ð²Ð¸Ð¹Ð¼Ð°Ñ”Ð¼Ð¾ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² ÑÐºÑ– Ñ„Ñ–Ð½Ñ–ÑˆÑƒÐ²Ð°Ð»Ð¸ 30 Ñ…Ð² Ð½Ð°Ð·Ð°Ð´
            }
            $telegram_log = Telegram_log::where('event_id', $event_id)->get();
            if ($status=='stop') {
                $peopless = Mopcompetitor::where('cid', $event_id)->get(); // Ð²Ð¸Ð¹Ð¼Ð°Ñ”Ð¼Ð¾ ÑƒÑ‡Ð°ÑÐ½Ð¸ÐºÑ–Ð² ÑÐºÑ– Ñ„Ñ–Ð½Ñ–ÑˆÑƒÐ²Ð°Ð»Ð¸ 30 Ñ…Ð² Ð½Ð°Ð·Ð°Ð´
            }
            $telegram_log = Telegram_log::where('event_id', $event_id)->get();



            foreach ($peopless as $people)  $name[] = $people->name;
            if ($name > 0) $telegram = Telegram::whereIn('name', $name)->get(); // ÑÑ‚Ð²Ð¾Ñ€ÑŽÑ” ÐºÐ¾Ð½Ñ‚Ð°ÐºÑ‚Ð¸ ÑÐºÐ¸Ð¼ Ð¿Ð¾Ñ‚Ñ€Ñ–Ð±Ð½Ð¾ Ð·Ñ€Ð¾Ð±Ð¸Ñ‚Ð¸ Ñ€Ð¾Ð·ÑÐ¸Ð»ÐºÑƒ
            // dd($telegram);
            if (!is_object($telegram)) {
                return 'ÐŸÐ¾ÐºÐ¸ Ð½ÐµÐ¼Ð°Ñ” Ð¶Ð»Ð´Ð½Ð¾Ð³Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ñƒ Ð°Ð±Ð¾ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð¾Ñ— Ñ‚Ð¾Ð¼Ñƒ Ð·Ð°Ð¿ÑƒÑÑ‚Ñ‚ÑŒ Ð¾Ð½Ð»Ð°Ð¹Ð½ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ñ‚Ð°Ñ‚Ð¸ Ð² Ð¼ÐµÐ¾Ñ';
            }
            foreach ($telegram as $t) {
                $not = 0;
                $telegram_lo =  $telegram_log->where('user_id', $t->id)->where('stat', $status)->first();
                // echo $not->id;

                $people = $peopless->where('name', $t->name)->first();
                $t->name = $people->name;
                $t->club = self::clubsearh($clubs, $people);
                $t->grup = self::grupsearh($grups, $people);
                $t->rt = self::formatTime($people->rt);
                $t->st = self::formatTime($people->st);
                $t->rez = self::rez_stat($people);
                $t->mistse = self::mistse($people, $peopless);
                $t->created_at =  $telegram_log->where('name', $people->name)->first()->created_at;
                $rt=$people->rt + $people->stat;
                $st=$people->st + $people->stat;
                // echo $st."-"; 
                // echo $telegram_lo->st."/"; 


                if ($telegram_lo->stat != 'start' and $st != $telegram_lo->st and $status=='start') {
                    if ($t->si!=0) {
                        $si="( Ñ– ÐºÐ¾Ð¼Ð¿Ð°Ñ Ð· Ñ‡Ñ–Ð¿Ð¾Ð¼" . $t->si . " Ð½Ðµ Ð·Ð°Ð±ÑƒÐ´ÑŒðŸ˜‰)";
                    }
                  $messeg = "
                  ðŸš€ðŸš€ðŸš€Â«" . $t->name . ", Ð²Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾ Ð½Ð° Ð·Ð¼Ð°Ð³Ð°Ð½Ð½ÑÑ…: Â«" . $event->name . "Â» ðŸš€
Ð¢Ð¾Ð±Ñ– Ð¿Ñ€Ð¸ÑÐ²Ð¾Ñ”Ð½Ð¾ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñƒ Ñ…Ð²Ð¸Ð»Ð¸Ð½Ñƒ: " . $t->start_time . "Ð”Ð¾ Ð·ÑƒÑÑ‚Ñ€Ñ–Ñ‡Ñ– Ñƒ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð¾Ð¼Ñƒ ÐºÐ¾Ñ€Ð¸Ð´Ð¾Ñ€Ñ–ðŸ˜Š.".$si."
Ð‘Ð°Ð¶Ð°ÑŽ Ð²Ð´Ð°Ð»Ð¾Ñ— Ð´Ð¸ÑÑ‚Ð°Ð½Ñ†Ñ–Ñ—ðŸ’ª

Ð£ÑÑ– Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð¸  ÑÑ‚Ð°Ñ€Ñ‚Ñƒ, Ð° Ñ‚Ð°ÐºÐ¾Ð¶  Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Online Ñ‚ÑƒÑ‚ðŸ‘‡
https://event-o.net/livess/show/ " . $event_id." ðŸš€ðŸš€ðŸš€" ;

                    self::create_log($t->name, $t->id, $event_id,  $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                } 



                elseif ($telegram_lo->stat == 'start' and $st != $telegram_lo->st and $status=='start') {
                    if ($t->si!=0) {
                        $si="( Ñ– ÐºÐ¾Ð¼Ð¿Ð°Ñ Ð· Ñ‡Ñ–Ð¿Ð¾Ð¼" . $t->si . " Ð½Ðµ Ð·Ð°Ð±ÑƒÐ´ÑŒðŸ˜‰)";
                    }
                  $messeg = "
                  ðŸš€ðŸš€ðŸš€Â«" . $t->name . ", Ð²Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾ Ð½Ð° Ð·Ð¼Ð°Ð³Ð°Ð½Ð½ÑÑ…: Â«" . $event->name . "Â» ðŸš€
Ð¢Ð¾Ð±Ñ– Ð¿Ñ€Ð¸ÑÐ²Ð¾Ñ”Ð½Ð¾ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ñƒ Ñ…Ð²Ð¸Ð»Ð¸Ð½Ñƒ: " . $t->start_time . "Ð”Ð¾ Ð·ÑƒÑÑ‚Ñ€Ñ–Ñ‡Ñ– Ñƒ ÑÑ‚Ð°Ñ€Ñ‚Ð¾Ð²Ð¾Ð¼Ñƒ ÐºÐ¾Ñ€Ð¸Ð´Ð¾Ñ€Ñ–ðŸ˜Š.".$si."
Ð‘Ð°Ð¶Ð°ÑŽ Ð²Ð´Ð°Ð»Ð¾Ñ— Ð´Ð¸ÑÑ‚Ð°Ð½Ñ†Ñ–Ñ—ðŸ’ª

Ð£ÑÑ– Ð¿Ñ€Ð¾Ñ‚Ð¾ÐºÐ¾Ð»Ð¸  ÑÑ‚Ð°Ñ€Ñ‚Ñƒ, Ð° Ñ‚Ð°ÐºÐ¾Ð¶  Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð¸ Online Ñ‚ÑƒÑ‚ðŸ‘‡
https://event-o.net/livess/show/ " . $event_id." ðŸš€ðŸš€ðŸš€" ;

                    self::edit_log($telegram_lo->id, $t->name , $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                } 



                elseif(  $telegram_lo->stat != 'go' and $rt != $telegram_lo->rt and $status=='go' ) {
                   $messeg = "
ðŸðŸðŸÂ«" . $t->name . ", Ð²Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾ Ð½Ð° Ñ„Ñ–Ð½Ñ–ÑˆÑ– Ð·Ð¼Ð°Ð³Ð°Ð½ÑŒ: Â«" . $event->name . "Â» ðŸ’ª
Ð¢Ð²Ñ–Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚: " . $t->rez . " Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ðµ " . $t->mistse . ", Ð¼Ñ–ÑÑ†Ðµ Ñƒ Ð³Ñ€ÑƒÐ¿Ñ– " . $t->grup . "
Ð¡Ð»Ñ–Ð´ÐºÑƒÐ¹ Ð·Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ð¼Ð¸ OnlineðŸ‘‡
https://event-o.net/livess/show/" . $event_id . "

Ð‘Ð°Ð¶Ð°Ñ”Ð¼Ð¾ Ð¿Ð¾Ð´Ð°Ð»ÑŒÑˆÐ¸Ñ… ÑƒÑÐ¿Ñ–Ñ…Ñ–Ð²! ðŸ†ðŸðŸðŸ";

                    self::create_log($t->name, $t->id, $event_id, $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                }




                elseif (  $telegram_lo->stat == 'go'  and $rt != $telegram_lo->rt and $status=='go' ) {
                    $messeg = "
ðŸðŸðŸÂ«" . $t->name . ", Ð²Ñ–Ñ‚Ð°Ñ”Ð¼Ð¾ Ð½Ð° Ñ„Ñ–Ð½Ñ–ÑˆÑ– Ð·Ð¼Ð°Ð³Ð°Ð½ÑŒ: Â«" . $t->event->name . "Â» ðŸ’ª
Ð¢Ð²Ñ–Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¾Ð½Ð¾Ð²Ð»ÐµÐ½Ð¾: " . $t->rez . " Ð¿Ð¾Ñ‚Ð¾Ñ‡Ð½Ðµ " . $t->mistse . ", Ð¼Ñ–ÑÑ†Ðµ Ñƒ Ð³Ñ€ÑƒÐ¿Ñ– " . $t->grup . "
Ð¡Ð»Ñ–Ð´ÐºÑƒÐ¹ Ð·Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ð¼Ð¸ OnlineðŸ‘‡
https://event-o.net/livess/show/" . $event_id . "

Ð‘Ð°Ð¶Ð°Ñ”Ð¼Ð¾ Ð¿Ð¾Ð´Ð°Ð»ÑŒÑˆÐ¸Ñ… ÑƒÑÐ¿Ñ–Ñ…Ñ–Ð²! ðŸ†ðŸðŸðŸ";

                    self::edit_log($telegram_lo->id, $t->name , $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                }
            }
            // dd($telegram);
            $telegram = $telegram->sortByDesc('created_at');


            return view('live.telegram.telegram_online', compact('telegram', 'dani'));
        } else {
            echo "ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð½Ðµ Ð²Ñ–Ñ€Ð½Ð¸Ð¹";
        }
    }
    static function message_to_telegram($bot_token, $chat_id, $text, $reply_markup = '')
    {
        $ch = curl_init();
        $ch_post = [
            CURLOPT_URL => 'https://api.telegram.org/bot' . $bot_token . '/sendMessage',
            CURLOPT_POST => TRUE,
            CURLOPT_RETURNTRANSFER => TRUE,
            CURLOPT_TIMEOUT => 10,
            CURLOPT_POSTFIELDS => [
                'chat_id' => $chat_id,
                'parse_mode' => 'HTML',
                'text' => $text,
                'reply_markup' => $reply_markup,
            ]
        ];

        curl_setopt_array($ch, $ch_post);
        curl_exec($ch);
    }

    // ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
    static function set_bot_state($chat_id, $data)
    {
        file_put_contents(__DIR__ . '/users/' . $chat_id . '.txt', $data);
    }

    // Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ñ‚ÐµÐºÑƒÑ‰ÐµÐµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ðµ Ð±Ð¾Ñ‚Ð° Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ

    static function add_name_table($username, $name, $user_id)
    {
        $names = Telegram::where('user_id', $user_id)->where('name', $name)->first();
        if (!$names and strlen($name) >= 10) {
            $telegram = new Telegram;
            $telegram->username = $username;
            $telegram->name = $name;
            $telegram->user_id = $user_id; // Set the value for the 'd' field
            $telegram->save();
        }
    }




    static function get_bot_state($chat_id)
    {
        if (file_exists(__DIR__ . '/users/' . $chat_id . '.txt')) {
            $data = file_get_contents(__DIR__ . '/users/' . $chat_id . '.txt');
            return $data;
        } else {
            return '';
        }
    }


    static function create_log($name, $id, $event_id, $rt, $st, $stat)
    {
        $telegram = new Telegram_log();
        $telegram->name = $name;
        $telegram->rt = $rt;
        $telegram->st = $st;
        $telegram->user_id = $id;
        $telegram->event_id = $event_id;
        $telegram->stat = $stat;
        $telegram->save();
    }

    static function edit_log($id, $name , $rt, $st, $stat){
        $telegram = Telegram_log::find($id);
        $telegram->name = $name;
        $telegram->rt = $rt;
        $telegram->st = $st;
        // $telegram->user_id = $user_id;
        // $telegram->event_id = $event_id;
        $telegram->stat = $stat;
        $telegram->save();
    }
    //Ð¤ÑƒÐ½ÐºÑ†Ñ–Ñ—
    static function grupsearh($grups, $people)
    { //Ð¨ÑƒÐºÐ°Ñ” Ñ€ÑƒÐ¿Ñƒ Ð² Ð±Ð°Ð·Ñ– Ð´Ð°Ð½Ð¸Ñ… Ð· Ð³Ñ€ÑƒÐ¿Ð°Ð¼Ð¸
        foreach ($grups as $grupa) {
            if ($grupa->id == $people->cls) $grup = $grupa->name;
        }
        return $grup;
    }

    static function clubsearh($clubs, $people)
    { //Ð¨ÑƒÐºÐ°Ñ” ÐºÐ»ÑƒÐ± Ð² Ð±Ð°Ð·Ñ– Ð´Ð°Ð½Ð¸Ñ… Ð· Ð³Ñ€ÑƒÐ¿Ð°Ð¼Ð¸
        foreach ($clubs as $cluba) {
            if ($cluba->id == $people->org) $club = $cluba->name;
        }
        return $club;
    }

    static function statussearh($people)
    { //Ð¨ÑƒÐºÐ°Ñ” Ð¡Ñ‚Ð°Ñ‚ÑƒÑ 
        $status = $people->stat;
        switch ($status) {
            case 0:
                return " "; //Unknown, running?
            case 1:
                return "OK";
            case 20:
                return "DNS"; // Did not start;
            case 21:
                return "CANCEL"; // Cancelled entry;
            case 3:
                return "MP"; // Missing punch
            case 4:
                return "DNF"; //Did not finish
            case 5:
                return "DQ"; // Disqualified
            case 6:
                return "OT"; // Overtime
            case 99:
                return "NP"; //Not participating;
        }
    }

    static function plases($status, $mistse)
    { // Ð¼Ñ–ÑÑ†Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð³Ð¾ ÑÐ¾Ñ€Ñ‚ÑƒÐ²Ð½Ð½Ñ
        switch ($status) {
            case 0:
                return 99999999; //Unknown, running?
            case 1:
                return $mistse;
            case 20:
                return 99999992; // Did not start;
            case 21:
                return 99999995; // Cancelled entry;
            case 3:
                return 99999994; // Missing punch
            case 4:
                return 99999991; //Did not finish
            case 5:
                return 99999993; // Disqualified
            case 6:
                return 99999997; // Overtime
            case 99:
                return 99999996; //Not participating;
        }
    }

    static function formatTime($time)
    { //Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ‡Ð°ÑÑƒ
        $time = $time / 10;
        if ($time > 3600)
            return sprintf("%d:%02d:%02d", $time / 3600, ($time / 60) % 60, $time % 60);
        elseif ($time > 0)
            return sprintf("%2d:%02d", ($time / 60) % 60, $time % 60);
        else
            return '0:00';
    }


    static function formatVids($time, $stat)
    { //Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚ Ñ‡Ð°ÑÑƒ Ð²Ñ–Ð´ÑÑ‚Ð°Ð²Ð°Ð½Ð½Ñ
        $time = $time / 10;
        if ($time > 3600 and $stat == 1)
            return sprintf("+%d:%02d:%02d", $time / 3600, ($time / 60) % 60, $time % 60);
        elseif ($time > 0  and $stat == 1)
            return sprintf("+%2d:%02d", ($time / 60) % 60, $time % 60);
        elseif ($stat == 1)
            return 'Ð›Ð†Ð”Ð•Ð ';
    }


    static function rez_stat($people)
    { //Ð·Ñ”Ð´Ð½Ñ€ÑƒÑ” ÑÑ‚Ð°Ñ‚ÑƒÑ Ñ‚Ð° Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚
        if ($people->stat != 1)
            return SiteOnlineController::statussearh($people);
        else
            return SiteOnlineController::formatTime($people->rt);
    }




    static function mistse($people, $peopless)
    { //Ð²Ð¸Ð·Ð½Ð°Ñ‡Ð°Ñ” Ð¿Ñ€Ð¾ÑÑ‚Ð¾ Ð¼Ñ–ÑÑƒÑ†Ðµ
        foreach ($peopless as $peoples) {
            if ($peoples->cls == $people->cls and $people->stat == 1 and $peoples->stat == 1 and $peoples->rt < $people->rt) {
                $x = $x + 1;
            }
        }
        if ($people->stat != 1) {
            return $x = ' ';
        } else return $x + 1;
    }

    static function count_people($peoples)
    {
    }

    static function count_club($clubs)
    {
        foreach ($clubs as $ckub) {
            $x = $x + 1;
        }
        return $x;
    }

  
}
