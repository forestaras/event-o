<?php

namespace App\Http\Controllers;

use Illuminate\Http\Request;
use App\Models\Mopclass;
use App\Models\Mopcompetition;
use App\Models\Mopcompetitor;
use App\Models\Moporganization;
use App\Models\Online;
use App\Models\Telegram;
use App\Models\Telegram_log;

class TelegramController extends Controller
{
    public function message(Request $request)
    {
        Telegram_log::info($request->all());
        $site_dir = dirname(dirname(__FILE__)) . '/'; // –∫–æ—Ä–µ–Ω—å —Å–∞–π—Ç–∞
        $data = file_get_contents('php://input'); // –≤–µ—Å—å –≤–≤–æ–¥ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –≤ $data
        $data = json_decode($data, true); // –¥–µ–∫–æ–¥–∏—Ä—É–µ–º json-–∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ-—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ PHP-–º–∞—Å—Å–∏–≤
        $bot_token = '2107045715:AAFH4DLnTFuxLCTxZ17FGLj0hHCbNbAbOm8'; // —Ç–æ–∫–µ–Ω –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
        file_put_contents(__DIR__ . '/message.txt', print_r($data, true));
        if (!empty($request->message['text'])) {
            $chat_id = $request->message['from']['id'];
            $user_name = $request->message['from']['username'];
            $first_name = $request->message['from']['first_name'];
            $last_name = $request->message['from']['last_name'];
            $text = trim($request->message['text']);
            $text_array = explode(" ", $text);
            $bot_state = self::get_bot_state($chat_id);

            if (substr($bot_state, 0, 6) == '/name') { // –µ—Å–ª–∏ —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞ –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞—è–≤–∫–∏, —Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–º –∑–∞—è–≤–∫—É –º–µ–Ω–µ–¥–∂–µ—Ä—É –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞ $order_chat_id
                $text_return = 
$text . " –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è. –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç–∏ —â–µ –∫–æ–≥–æ—Å—å, –ø–µ—Ä–µ–π–¥—ñ—Ç—å /name. üìù
–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –º–æ–∂–Ω–∞ —Ç—É—Ç /list_name. üëÄ

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ /name –≤–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —ñ–º–µ–Ω–∞ –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è. –¶–µ –¥–æ–∑–≤–æ–ª–∏—Ç—å –±–æ—Ç—É Event_O –Ω–∞–¥—Å–∏–ª–∞—Ç–∏ –≤–∞–º –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ —Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º–∏ –ø—Ä–æ –æ–±—Ä–∞–Ω—ñ —É—á–∞—Å–Ω–∏–∫–∏ –∞–±–æ –ø–æ–¥—ñ—ó. –í–∞–º –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞—Ç–∏ –∂–æ–¥–Ω—É –≤–∞–∂–ª–∏–≤—É –ø–æ–¥—ñ—é –∞–±–æ –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è, –æ—Å–∫—ñ–ª—å–∫–∏ –±–æ—Ç –±—É–¥–µ —Å—Ç–µ–∂–∏—Ç–∏ –∑–∞ –≤–∞–º–∏. üöÄ

–ù–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –¥–æ–¥–∞–≤–∞—Ç–∏ –±—ñ–ª—å—à–µ —ñ–º–µ–Ω –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è. –¶–µ –±–µ–∑–ø–µ—á–Ω–∏–π —Å–ø–æ—Å—ñ–± –±—É—Ç–∏ –≤ –∫—É—Ä—Å—ñ –≤—Å—å–æ–≥–æ, —â–æ –≤–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å. –ü—Ä–æ—Å—Ç–æ –≤–≤–µ–¥—ñ—Ç—å —ñ–º'—è —É—á–∞—Å–Ω–∏–∫–∞ —Ç–∞ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –π–æ–≥–æ –±–æ—Ç—É, —ñ –≤—ñ–Ω –¥–æ–¥–∞—Å—Ç—å –π–æ–≥–æ –¥–æ —Å–ø–∏—Å–∫—É. üòä

–ù–µ –∑–∞–±—É–¥—å—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ /list_name. –í–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ—Ö –¥–æ–¥–∞–Ω–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤ –∞–±–æ –ø–æ–¥—ñ—ó —ñ –≤–ø–µ–≤–Ω–∏—Ç–∏—Å—è, —â–æ –≤–∞—à —Å–ø–∏—Å–æ–∫ –∞–∫—Ç—É–∞–ª—å–Ω–∏–π. üë•

–Ø–∫—â–æ –≤–∏ –º–∞—î—Ç–µ —è–∫—ñ-–Ω–µ–±—É–¥—å –ø–∏—Ç–∞–Ω–Ω—è, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help, —â–æ–± –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ–¥–∞—Ç–∫–æ–≤—É –¥–æ–ø–æ–º–æ–≥—É. ü§îüí°";


                self::message_to_telegram($bot_token, $chat_id, $text_return);
                self::add_name_table($user_name, $text, $chat_id);
                self::set_bot_state($chat_id, '/help'); // –Ω–µ –∑–∞–±—É–¥–µ–º –ø–æ—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É, –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
            } 
            
            
            elseif (substr($bot_state, 0, 6) == '/delet') {
                $text_return = "
‚úÖ –í–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–∏–ª–∏ $text –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è.

–Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —â–µ –∫–æ–≥–æ—Å—å –∑—ñ —Å–ø–∏—Å–∫—É, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è –∫–æ–º–∞–Ω–¥–æ—é /delet.

üìã –î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–æ–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /list_name.

ü§î –ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞ –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è? –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help. üòäüëç";
                self::message_to_telegram($bot_token, $chat_id, $text_return);
                Telegram::where('name', $text)->where('user_id', $chat_id)->delete();
                self::set_bot_state($chat_id, '/help'); // –Ω–µ –∑–∞–±—É–¥–µ–º –ø–æ—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É, –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
            } 
            
            
            
            elseif (substr($bot_state, 0, 10) == '/all_delet') {
                $text_return = "
‚úÖ –í–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–∏–ª–∏ –≤—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤ –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É.

–¢–µ–ø–µ—Ä –≤–∞—à —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –ø–æ—Ä–æ–∂–Ω—ñ–π. –Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤—É –ª—é–¥–∏–Ω—É –¥–æ —Å–ø–∏—Å–∫—É, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è –∫–æ–º–∞–Ω–¥–æ—é /name.

üìù –í–≤–µ–¥—ñ—Ç—å –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è, —è–∫–µ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ –¥–æ —Å–ø–∏—Å–∫—É, —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

üìã –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –º–æ–∂–Ω–∞ –∫–æ–º–∞–Ω–¥–æ—é /list_name.

ü§î –ü–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–ø–æ–º–æ–≥–∞ –∞–±–æ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è? –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help. üòäüëç";
                self::message_to_telegram($bot_token, $chat_id, $text_return);
                Telegram::where('user_id', $chat_id)->delete();
                self::set_bot_state($chat_id, '/help'); // –Ω–µ –∑–∞–±—É–¥–µ–º –ø–æ—á–∏—Å—Ç–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ –ø—É—Å—Ç–æ—Ç—É, –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏
            } 
            
            
            
            else {
                if ($text == '/start') {
                    $text_return = "
–ü—Ä–∏–≤—ñ—Ç, $first_name $last_name! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –±–æ—Ç–∞ Event_O! ü§ñ‚ú®

–¶—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:
                    
/help - –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ üìö‚ùì
/about - –¥—ñ–∑–Ω–∞—Ç–∏—Å—è –±—ñ–ª—å—à–µ –ø—Ä–æ –±–æ—Ç–∞ Event_O ‚ÑπÔ∏èü§ñ
/name - –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ —ñ–º'—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è ‚ûïüë§
/list_name - –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è üë•üìã
                    
–ó–∞–ø–∞–º'—è—Ç–∞–π—Ç–µ, –±–æ—Ç Event_O –∑–∞–≤–∂–¥–∏ –≥–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –∑ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è–º –∞–∫—Ç—É–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —â–æ–¥–æ –ø–æ–¥—ñ–π —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. üìùüí°
                    
–Ø–∫—â–æ —É –≤–∞—Å —î –±—É–¥—å-—è–∫—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –ø–æ—Ç—Ä–µ–±–∞ –≤ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ–π –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ, –Ω–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –∑–≤–µ—Ä—Ç–∞—Ç–∏—Å—è –¥–æ –º–µ–Ω–µ. üòäüëã
                    
–ë–∞–∂–∞—î–º–æ –≤–∞–º –ø—Ä–∏—î–º–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è –±–æ—Ç–æ–º Event_O —Ç–∞ —É—Å–ø—ñ—Ö—ñ–≤ —É –≤—Å—ñ—Ö –≤–∞—à—ñ—Ö –ø–æ–¥—ñ—è—Ö! üéâüåü";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/help');
                } 
                
                
                
                elseif ($text == '/about') {
                    $text_return = "
ü§ñ –ù–∞–∑–≤–∞: Event_O
üìö –û–ø–∏—Å: Event_O - —Ü–µ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ–¥—ñ–π —ñ –∑–º–∞–≥–∞–Ω—å. –í—ñ–Ω –¥–æ–ø–æ–º–∞–≥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –±—É—Ç–∏ –≤ –∫—É—Ä—Å—ñ –æ–Ω–æ–≤–ª–µ–Ω—å —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —Ç–∞ —ó—Ö –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è.
üí° –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª: –ë–æ—Ç –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞–≤–∞—Ç–∏ —ñ–º–µ–Ω–∞ —É—á–∞—Å–Ω–∏–∫—ñ–≤ –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è, –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —ó—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞ –º—ñ—Å—Ü–µ –≤ –∑–º–∞–≥–∞–Ω–Ω—è—Ö. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–∏—Ö —ñ–º–µ–Ω —ñ –∑—Ä—É—á–Ω–æ –∫–µ—Ä—É–≤–∞—Ç–∏ —Å–ø–∏—Å–∫–æ–º –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è.
‚úÖ –ö–æ–º–∞–Ω–¥–∏:
/help - –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥ —Ç–∞ —ó—Ö –æ–ø–∏—Å.
/name - –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ —ñ–º'—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è.
/list_name - –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–∏—Ö —ñ–º–µ–Ω.

–ù–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –±–æ—Ç–∞ Event_O –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∞–∫—Ç—É–∞–ª—å–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –≤–∞—à—ñ —É–ª—é–±–ª–µ–Ω—ñ –ø–æ–¥—ñ—ó. –Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–Ω—É—Ç—å –∑–∞–ø–∏—Ç–∞–Ω–Ω—è, –∑–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—è –¥–æ –±–æ—Ç–∞ - —è –∑–∞–≤–∂–¥–∏ –≥–æ—Ç–æ–≤–∏–π –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º! ü§óüèÜ";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/about');
                } 
                
                
                
                
                elseif ($text == '/help') {
                    $text_return = "
–ü—Ä–∏–≤—ñ—Ç, $first_name $last_name! –Ø - –±–æ—Ç Event_O, —è–∫–∏–π —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ–¥—ñ–π —ñ –∑–º–∞–≥–∞–Ω—å. –î–æ–∑–≤–æ–ª—å—Ç–µ –º–µ–Ω—ñ —Ä–æ–∑–ø–æ–≤—ñ—Å—Ç–∏ –≤–∞–º –ø—Ä–æ –¥–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:

/help - —Ü—è –∫–æ–º–∞–Ω–¥–∞ –Ω–∞–¥–∞—Å—Ç—å –≤–∞–º –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ —ñ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —ó—Ö —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É. –í–∏ –∑–º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ –±–æ—Ç–∞. üòäüìö
                    
/about - —Ü—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–∑–≤–æ–ª–∏—Ç—å –≤–∞–º –æ—Ç—Ä–∏–º–∞—Ç–∏ –æ–≥–ª—è–¥ –ø—Ä–æ –±–æ—Ç–∞ Event_O. –í–∏ –¥—ñ–∑–Ω–∞—î—Ç–µ—Å—å –ø—Ä–æ –π–æ–≥–æ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è, –æ—Å–Ω–æ–≤–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó —Ç–∞ —Ç–µ, —è–∫ —è –º–æ–∂—É –±—É—Ç–∏ –≤–∞–º –∫–æ—Ä–∏—Å–Ω–∏–º. ü§ñüí°
                    
/name - —Ü—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ —ñ–º'—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è. –Ø –±—É–¥—É –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –≤–∫–∞–∑–∞–Ω–æ—ó –æ—Å–æ–±–∏ —ñ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –≤–∞—Å –ø—Ä–æ —ó—Ö –æ–Ω–æ–≤–ª–µ–Ω–Ω—è. üìù‚úÖ
                    
/list_name - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü—é –∫–æ–º–∞–Ω–¥—É, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ —ñ–º–µ–Ω, —è–∫—ñ —è –≤—ñ–¥—Å—Ç–µ–∂—É—é. –í–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ –¥–æ–¥–∞–Ω—ñ —ñ–º–µ–Ω–∞ —ñ –±—É—Ç–∏ –≤ –∫—É—Ä—Å—ñ —ó—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. üìãüëÄ
                    
–ù–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–ø–∏—Å–∫–æ–º –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è.
                    
–Ø –∑–∞–≤–∂–¥–∏ —Ç—É—Ç, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –∑ –±—É–¥—å-—è–∫–∏–º–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è–º–∏ –∞–±–æ –ø–æ—Ç—Ä–µ–±–æ—é –≤ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ–π –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ. –ó–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—å –¥–æ –±–æ—Ç–∞ Event_O —ñ –æ—Ç—Ä–∏–º—É–π—Ç–µ –∑—Ä—É—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–∞—à—ñ —É–ª—é–±–ª–µ–Ω—ñ –ø–æ–¥—ñ—ó! üòäü§ñ";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/about');
                } 
                
                
                
                
                elseif ($text == '/name') {
                    $text_return = "
$first_name $last_name, –¥–ª—è —Ç–æ–≥–æ —â–æ–± –¥–æ–¥–∞—Ç–∏ —ñ–º–µ–Ω–∞, –∑–∞ —è–∫–∏–º–∏ –≤–∏ —Ö–æ—á–µ—Ç–µ —Å–ª—ñ–¥–∫—É–≤–∞—Ç–∏, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à—ñ—Ç—å '–ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º—è' —ñ –≤—ñ–¥–ø—Ä–∞–≤—Ç–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è. üìù

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥–æ–¥–∞—Ç–∏ —É—á–∞—Å–Ω–∏–∫–∞ –∑ —ñ–º–µ–Ω–µ–º –Ü–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à—ñ—Ç—å '–ü–µ—Ç—Ä–æ–≤ –Ü–≤–∞–Ω' —ñ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –π–æ–≥–æ –±–æ—Ç—É. üßë‚Äçüíª

–ë–æ—Ç Event_O –±—É–¥–µ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ —Ü–µ —ñ–º'—è —ñ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –≤–∞—Å –ø—Ä–æ –±—É–¥—å-—è–∫—ñ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–±–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ —Ü–∏–º —É—á–∞—Å–Ω–∏–∫–æ–º. –í–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –±–∞–≥–∞—Ç–æ —ñ–º–µ–Ω, —è–∫—ñ –≤–∞—Å —Ü—ñ–∫–∞–≤–ª—è—Ç—å. –ù–µ –∑–∞–±—É–¥—å—Ç–µ, —â–æ –≤–∏ –∑–∞–≤–∂–¥–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –∫–æ–º–∞–Ω–¥–∏ /list_name. üë•

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è –∫–æ–º–∞–Ω–¥–æ—é /help. ü§îüí°

–ù–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º –±–æ—Ç—É Event_O —ñ –æ—Ç—Ä–∏–º—É–π—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–∞—à—ñ —É–ª—é–±–ª–µ–Ω—ñ –ø–æ–¥—ñ—ó —Ç–∞ —É—á–∞—Å–Ω–∏–∫—ñ–≤! üöÄ‚ú®";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/name');
                } 
                
                
                
                
                elseif ($text == '/list_name') {
                    $spisocs = Telegram::where('user_id', $chat_id)->get();
                    $count = $spisocs->count();
                    $spis = " ";
                    foreach ($spisocs as $spisoc) {
                        $spis = "$spis ($spisoc->name)";
                    }
                   $text_return = "
–£ –≤–∞—à–æ–º—É —Å–ø–∏—Å–∫—É –∑–∞—Ä–∞–∑ –∑–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è $count –ª—é–¥–∏–Ω–∏: 

$spis

–©–æ–± –≤–∏–¥–∞–ª–∏—Ç–∏ –∫–æ–≥–æ—Å—å –∑—ñ —Å–ø–∏—Å–∫—É, –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å /delet.

–Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –æ—á–∏—Å—Ç–∏—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—å –∫–æ–º–∞–Ω–¥–æ—é /all_delet.

üë• –í–∏ –º–æ–∂–µ—Ç–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –∞–±–æ –≤–∏–¥–∞–ª—è—Ç–∏ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —É –±—É–¥—å-—è–∫–∏–π —á–∞—Å, —â–æ–± –∑–∞–±–µ–∑–ø–µ—á–∏—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—ñ—Å—Ç—å –≤–∞—à–æ–≥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è. –î–æ–¥–∞–≤–∞–π—Ç–µ —Å–≤–æ—ó—Ö —É–ª—é–±–ª–µ–Ω–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤ —ñ –∑–∞–ª–∏—à–∞–π—Ç–µ—Å—å –≤ –∫—É—Ä—Å—ñ —ó—Ö–Ω—ñ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Ç–∞ –ø–æ–¥—ñ–π! üèÉ‚Äç‚ôÄÔ∏èüí®

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help. ü§îüí°

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –±–æ—Ç–∞ Event_O –∑ –∑–∞–¥–æ–≤–æ–ª–µ–Ω–Ω—è–º —Ç–∞ –Ω–∞—Å–æ–ª–æ–¥–∂—É–π—Ç–µ—Å—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é –ø—Ä–æ –≤–∞—à—ñ —É–ª—é–±–ª–µ–Ω—ñ –ø–æ–¥—ñ—ó —Ç–∞ —É—á–∞—Å–Ω–∏–∫—ñ–≤! üöÄ‚ú®";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/list_name');
                } 
                
                
                
                
                elseif ($text == '/delet') {
                    $text_return = "
–í–≤–µ–¥—ñ—Ç—å –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º'—è, —è–∫–µ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑—ñ —Å–ø–∏—Å–∫—É, —ñ –Ω–∞–¥—ñ—à–ª—ñ—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.

üóëÔ∏è –Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —É—á–∞—Å–Ω–∏–∫–∞ –∑—ñ —Å–ø–∏—Å–∫—É, –ø—Ä–æ—Å—Ç–æ –≤–∫–∞–∂—ñ—Ç—å –π–æ–≥–æ –ø–æ–≤–Ω–µ —ñ–º'—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –ü—Ä—ñ–∑–≤–∏—â–µ –Ü–º'—è.

üìù –Ø–∫—â–æ —É –≤–∞—Å —î –±–∞–≥–∞—Ç–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —É —Å–ø–∏—Å–∫—É, –º–æ–∂–µ—Ç–µ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ –≤–∏–¥–∞–ª—è—Ç–∏ —ó—Ö –æ–¥–Ω–æ–≥–æ –∑–∞ –æ–¥–Ω–∏–º. –í–∏ –º–æ–∂–µ—Ç–µ –≤–∏–¥–∞–ª—è—Ç–∏ –±–∞–∂–∞–Ω—É –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É—á–∞—Å–Ω–∏–∫—ñ–≤ –∑–∞ –æ–¥–∏–Ω —Ä–∞–∑.

‚ùóÔ∏è –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É—á–∞—Å–Ω–∏–∫–∞ –∑—ñ —Å–ø–∏—Å–∫—É –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤—ñ–¥—Å—É—Ç–Ω–æ—Å—Ç—ñ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –π–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ —Ç–∞ –ø–æ–¥—ñ–π.

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help. ü§îüí°";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/delet');
                } 
                
                
                
                
                elseif ($text == '/all_delet') {
                    $text_return = "
–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —É—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤ –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É?

üóëÔ∏è –¶—è –¥—ñ—è –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –ø–æ–≤–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤, —è–∫—ñ –≤–∏ –¥–æ–¥–∞–ª–∏ –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è. –£—Å—ñ —ó—Ö–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –±—É–¥—É—Ç—å –≤—Ç—Ä–∞—á–µ–Ω—ñ.

–Ø–∫—â–æ –≤–∏ –ø–µ–≤–Ω—ñ —É —Å–≤–æ—î–º—É —Ä—ñ—à–µ–Ω–Ω—ñ, –≤–∏–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –æ–ø—Ü—ñ–π:

/yes_delet_all - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤.
/no_delet_all - –≤—ñ–¥–º—ñ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ª–∏—à–∏—Ç–∏ —Å–ø–∏—Å–∫–æ–∫ –±–µ–∑ –∑–º—ñ–Ω.
‚ùóÔ∏è –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—è –¥—ñ—è –Ω–µ–æ–±–æ—Ä–æ—Ç–Ω–∞ —ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Å–∫–∞—Å–æ–≤–∞–Ω–∞. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –¥—ñ–π—Å–Ω–æ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤ –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É.

–Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help. ü§îüí°";
                    self::message_to_telegram($bot_token, $chat_id, $text_return);
                    self::set_bot_state($chat_id, '/all_delet');
                }
            }
        }
    }


    public function search2($event_id, $pass, $time, $status)
    {
        $online = Online::where('id', $event_id)->first();
        if ($online->cod == $pass) {
            $dani['stat'] = $status;
            $dani['pass'] = $pass;
            $dani['id'] = $event_id;
            $dani['time'] = $time;


            $token = '2107045715:AAFH4DLnTFuxLCTxZ17FGLj0hHCbNbAbOm8';

            $grups = Mopclass::where('cid', $event_id)->get();
            $event = Mopcompetition::where('cid', $event_id)->first();
            $clubs = Moporganization::where('cid', $event_id)->get();

            
            if ($status=='start') {
                $peopless = Mopcompetitor::where('cid', $event_id)->where('st', '>', 0)->get(); // –≤–∏–π–º–∞—î–º–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —è–∫—ñ —Ñ—ñ–Ω—ñ—à—É–≤–∞–ª–∏ 30 —Ö–≤ –Ω–∞–∑–∞–¥
            }
            if ($status=='go') {
                $peopless = Mopcompetitor::where('cid', $event_id)->where('rt', '>', 0)->get(); // –≤–∏–π–º–∞—î–º–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —è–∫—ñ —Ñ—ñ–Ω—ñ—à—É–≤–∞–ª–∏ 30 —Ö–≤ –Ω–∞–∑–∞–¥
            }
            $telegram_log = Telegram_log::where('event_id', $event_id)->get();
            if ($status=='stop') {
                $peopless = Mopcompetitor::where('cid', $event_id)->get(); // –≤–∏–π–º–∞—î–º–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —è–∫—ñ —Ñ—ñ–Ω—ñ—à—É–≤–∞–ª–∏ 30 —Ö–≤ –Ω–∞–∑–∞–¥
            }
            $telegram_log = Telegram_log::where('event_id', $event_id)->get();



            foreach ($peopless as $people)  $name[] = $people->name;
            if ($name > 0) $telegram = Telegram::whereIn('name', $name)->get(); // —Å—Ç–≤–æ—Ä—é—î –∫–æ–Ω—Ç–∞–∫—Ç–∏ —è–∫–∏–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏ —Ä–æ–∑—Å–∏–ª–∫—É
            // dd($telegram);
            if (!is_object($telegram)) {
                return '–ü–æ–∫–∏ –Ω–µ–º–∞—î –∂–ª–¥–Ω–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É –∞–±–æ —Å—Ç–∞—Ä—Ç–æ–≤–æ—ó —Ç–æ–º—É –∑–∞–ø—É—Å—Ç—Ç—å –æ–Ω–ª–∞–π–Ω —Ä–µ–∑—É–ª—å—Ç—Ç–∞—Ç–∏ –≤ –º–µ–æ—Å';
            }
            foreach ($telegram as $t) {
                $not = 0;
                $telegram_lo =  $telegram_log->where('user_id', $t->id)->where('stat', $status)->first();
                // echo $not->id;

                $people = $peopless->where('name', $t->name)->first();
                $t->name = $people->name;
                $t->club = self::clubsearh($clubs, $people);
                $t->grup = self::grupsearh($grups, $people);
                $t->rt = self::formatTime($people->rt);
                $t->st = self::formatTime($people->st);
                $t->rez = self::rez_stat($people);
                $t->mistse = self::mistse($people, $peopless);
                $t->created_at =  $telegram_log->where('name', $people->name)->first()->created_at;
                $rt=$people->rt + $people->stat;
                $st=$people->st + $people->stat;
                // echo $st."-"; 
                // echo $telegram_lo->st."/"; 


                if ($telegram_lo->stat != 'start' and $st != $telegram_lo->st and $status=='start') {
                    if ($t->si!=0) {
                        $si="( —ñ –∫–æ–º–ø–∞—Å –∑ —á—ñ–ø–æ–º" . $t->si . " –Ω–µ –∑–∞–±—É–¥—åüòâ)";
                    }
                  $messeg = "
                  üöÄüöÄüöÄ¬´" . $t->name . ", –≤—ñ—Ç–∞—î–º–æ –Ω–∞ –∑–º–∞–≥–∞–Ω–Ω—è—Ö: ¬´" . $event->name . "¬ª üöÄ
–¢–æ–±—ñ –ø—Ä–∏—Å–≤–æ—î–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤—É —Ö–≤–∏–ª–∏–Ω—É: " . $t->start_time . "–î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ —É —Å—Ç–∞—Ä—Ç–æ–≤–æ–º—É –∫–æ—Ä–∏–¥–æ—Ä—ñüòä.".$si."
–ë–∞–∂–∞—é –≤–¥–∞–ª–æ—ó –¥–∏—Å—Ç–∞–Ω—Ü—ñ—óüí™

–£—Å—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏  —Å—Ç–∞—Ä—Ç—É, –∞ —Ç–∞–∫–æ–∂  —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ Online —Ç—É—Çüëá
https://event-o.net/livess/show/ " . $event_id." üöÄüöÄüöÄ" ;

                    self::create_log($t->name, $t->id, $event_id,  $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                } 



                elseif ($telegram_lo->stat == 'start' and $st != $telegram_lo->st and $status=='start') {
                    if ($t->si!=0) {
                        $si="( —ñ –∫–æ–º–ø–∞—Å –∑ —á—ñ–ø–æ–º" . $t->si . " –Ω–µ –∑–∞–±—É–¥—åüòâ)";
                    }
                  $messeg = "
                  üöÄüöÄüöÄ¬´" . $t->name . ", –≤—ñ—Ç–∞—î–º–æ –Ω–∞ –∑–º–∞–≥–∞–Ω–Ω—è—Ö: ¬´" . $event->name . "¬ª üöÄ
–¢–æ–±—ñ –ø—Ä–∏—Å–≤–æ—î–Ω–æ —Å—Ç–∞—Ä—Ç–æ–≤—É —Ö–≤–∏–ª–∏–Ω—É: " . $t->start_time . "–î–æ –∑—É—Å—Ç—Ä—ñ—á—ñ —É —Å—Ç–∞—Ä—Ç–æ–≤–æ–º—É –∫–æ—Ä–∏–¥–æ—Ä—ñüòä.".$si."
–ë–∞–∂–∞—é –≤–¥–∞–ª–æ—ó –¥–∏—Å—Ç–∞–Ω—Ü—ñ—óüí™

–£—Å—ñ –ø—Ä–æ—Ç–æ–∫–æ–ª–∏  —Å—Ç–∞—Ä—Ç—É, –∞ —Ç–∞–∫–æ–∂  —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ Online —Ç—É—Çüëá
https://event-o.net/livess/show/ " . $event_id." üöÄüöÄüöÄ" ;

                    self::edit_log($telegram_lo->id, $t->name , $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                } 



                elseif(  $telegram_lo->stat != 'go' and $rt != $telegram_lo->rt and $status=='go' ) {
                   $messeg = "
üèÅüèÅüèÅ¬´" . $t->name . ", –≤—ñ—Ç–∞—î–º–æ –Ω–∞ —Ñ—ñ–Ω—ñ—à—ñ –∑–º–∞–≥–∞–Ω—å: ¬´" . $event->name . "¬ª üí™
–¢–≤—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: " . $t->rez . " –ø–æ—Ç–æ—á–Ω–µ " . $t->mistse . ", –º—ñ—Å—Ü–µ —É –≥—Ä—É–ø—ñ " . $t->grup . "
–°–ª—ñ–¥–∫—É–π –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Onlineüëá
https://event-o.net/livess/show/" . $event_id . "

–ë–∞–∂–∞—î–º–æ –ø–æ–¥–∞–ª—å—à–∏—Ö —É—Å–ø—ñ—Ö—ñ–≤! üèÜüèÅüèÅüèÅ";

                    self::create_log($t->name, $t->id, $event_id, $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                }




                elseif (  $telegram_lo->stat == 'go'  and $rt != $telegram_lo->rt and $status=='go' ) {
                    $messeg = "
üèÅüèÅüèÅ¬´" . $t->name . ", –≤—ñ—Ç–∞—î–º–æ –Ω–∞ —Ñ—ñ–Ω—ñ—à—ñ –∑–º–∞–≥–∞–Ω—å: ¬´" . $t->event->name . "¬ª üí™
–¢–≤—ñ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–Ω–æ–≤–ª–µ–Ω–æ: " . $t->rez . " –ø–æ—Ç–æ—á–Ω–µ " . $t->mistse . ", –º—ñ—Å—Ü–µ —É –≥—Ä—É–ø—ñ " . $t->grup . "
–°–ª—ñ–¥–∫—É–π –∑–∞ —Ä–µ–∑—É–ª—å—Ç–∞–º–∏ Onlineüëá
https://event-o.net/livess/show/" . $event_id . "

–ë–∞–∂–∞—î–º–æ –ø–æ–¥–∞–ª—å—à–∏—Ö —É—Å–ø—ñ—Ö—ñ–≤! üèÜüèÅüèÅüèÅ";

                    self::edit_log($telegram_lo->id, $t->name , $rt, $st, $status);
                    self::message_to_telegram($token, $t->user_id, $messeg);
                }
            }
            // dd($telegram);
            $telegram = $telegram->sortByDesc('created_at');


            return view('live.telegram.telegram_online', compact('telegram', 'dani'));
        } else {
            echo "–ü–∞—Ä–æ–ª—å –Ω–µ –≤—ñ—Ä–Ω–∏–π";
        }
    }
    static function message_to_telegram($bot_token, $chat_id, $text, $reply_markup = '')
    {
        $ch = curl_init();
        $ch_post = [
            CURLOPT_URL => 'https://api.telegram.org/bot' . $bot_token . '/sendMessage',
            CURLOPT_POST => TRUE,
            CURLOPT_RETURNTRANSFER => TRUE,
            CURLOPT_TIMEOUT => 10,
            CURLOPT_POSTFIELDS => [
                'chat_id' => $chat_id,
                'parse_mode' => 'HTML',
                'text' => $text,
                'reply_markup' => $reply_markup,
            ]
        ];

        curl_setopt_array($ch, $ch_post);
        curl_exec($ch);
    }

    // —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    static function set_bot_state($chat_id, $data)
    {
        file_put_contents(__DIR__ . '/users/' . $chat_id . '.txt', $data);
    }

    // –ø–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –±–æ—Ç–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

    static function add_name_table($username, $name, $user_id)
    {
        $names = Telegram::where('user_id', $user_id)->where('name', $name)->first();
        if (!$names and strlen($name) >= 10) {
            $telegram = new Telegram;
            $telegram->username = $username;
            $telegram->name = $name;
            $telegram->user_id = $user_id; // Set the value for the 'd' field
            $telegram->save();
        }
    }




    static function get_bot_state($chat_id)
    {
        if (file_exists(__DIR__ . '/users/' . $chat_id . '.txt')) {
            $data = file_get_contents(__DIR__ . '/users/' . $chat_id . '.txt');
            return $data;
        } else {
            return '';
        }
    }


    static function create_log($name, $id, $event_id, $rt, $st, $stat)
    {
        $telegram = new Telegram_log();
        $telegram->name = $name;
        $telegram->rt = $rt;
        $telegram->st = $st;
        $telegram->user_id = $id;
        $telegram->event_id = $event_id;
        $telegram->stat = $stat;
        $telegram->save();
    }

    static function edit_log($id, $name , $rt, $st, $stat){
        $telegram = Telegram_log::find($id);
        $telegram->name = $name;
        $telegram->rt = $rt;
        $telegram->st = $st;
        // $telegram->user_id = $user_id;
        // $telegram->event_id = $event_id;
        $telegram->stat = $stat;
        $telegram->save();
    }
    //–§—É–Ω–∫—Ü—ñ—ó
    static function grupsearh($grups, $people)
    { //–®—É–∫–∞—î —Ä—É–ø—É –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∑ –≥—Ä—É–ø–∞–º–∏
        foreach ($grups as $grupa) {
            if ($grupa->id == $people->cls) $grup = $grupa->name;
        }
        return $grup;
    }

    static function clubsearh($clubs, $people)
    { //–®—É–∫–∞—î –∫–ª—É–± –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö –∑ –≥—Ä—É–ø–∞–º–∏
        foreach ($clubs as $cluba) {
            if ($cluba->id == $people->org) $club = $cluba->name;
        }
        return $club;
    }

    static function statussearh($people)
    { //–®—É–∫–∞—î –°—Ç–∞—Ç—É—Å 
        $status = $people->stat;
        switch ($status) {
            case 0:
                return " "; //Unknown, running?
            case 1:
                return "OK";
            case 20:
                return "DNS"; // Did not start;
            case 21:
                return "CANCEL"; // Cancelled entry;
            case 3:
                return "MP"; // Missing punch
            case 4:
                return "DNF"; //Did not finish
            case 5:
                return "DQ"; // Disqualified
            case 6:
                return "OT"; // Overtime
            case 99:
                return "NP"; //Not participating;
        }
    }

    static function plases($status, $mistse)
    { // –º—ñ—Å—Ü–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —Å–æ—Ä—Ç—É–≤–Ω–Ω—è
        switch ($status) {
            case 0:
                return 99999999; //Unknown, running?
            case 1:
                return $mistse;
            case 20:
                return 99999992; // Did not start;
            case 21:
                return 99999995; // Cancelled entry;
            case 3:
                return 99999994; // Missing punch
            case 4:
                return 99999991; //Did not finish
            case 5:
                return 99999993; // Disqualified
            case 6:
                return 99999997; // Overtime
            case 99:
                return 99999996; //Not participating;
        }
    }

    static function formatTime($time)
    { //—Ñ–æ—Ä–º–∞—Ç —á–∞—Å—É
        $time = $time / 10;
        if ($time > 3600)
            return sprintf("%d:%02d:%02d", $time / 3600, ($time / 60) % 60, $time % 60);
        elseif ($time > 0)
            return sprintf("%2d:%02d", ($time / 60) % 60, $time % 60);
        else
            return '0:00';
    }


    static function formatVids($time, $stat)
    { //—Ñ–æ—Ä–º–∞—Ç —á–∞—Å—É –≤—ñ–¥—Å—Ç–∞–≤–∞–Ω–Ω—è
        $time = $time / 10;
        if ($time > 3600 and $stat == 1)
            return sprintf("+%d:%02d:%02d", $time / 3600, ($time / 60) % 60, $time % 60);
        elseif ($time > 0  and $stat == 1)
            return sprintf("+%2d:%02d", ($time / 60) % 60, $time % 60);
        elseif ($stat == 1)
            return '–õ–Ü–î–ï–†';
    }


    static function rez_stat($people)
    { //–∑—î–¥–Ω—Ä—É—î —Å—Ç–∞—Ç—É—Å —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        if ($people->stat != 1)
            return SiteOnlineController::statussearh($people);
        else
            return SiteOnlineController::formatTime($people->rt);
    }




    static function mistse($people, $peopless)
    { //–≤–∏–∑–Ω–∞—á–∞—î –ø—Ä–æ—Å—Ç–æ –º—ñ—Å—É—Ü–µ
        foreach ($peopless as $peoples) {
            if ($peoples->cls == $people->cls and $people->stat == 1 and $peoples->stat == 1 and $peoples->rt < $people->rt) {
                $x = $x + 1;
            }
        }
        if ($people->stat != 1) {
            return $x = ' ';
        } else return $x + 1;
    }

    static function count_people($peoples)
    {
    }

    static function count_club($clubs)
    {
        foreach ($clubs as $ckub) {
            $x = $x + 1;
        }
        return $x;
    }

  
}
