<?php

namespace App\Http\Controllers;

use App\Models\Telegram;
use Illuminate\Http\Request;

class New_Telegramt_messageController extends Controller
{
    static function messge_to_telegram($data)
    {
        if (!empty($data['message']['text'])) {
            $chat_id = $data['message']['from']['id'];
            $user_name = $data['message']['from']['username'];
            $first_name = $data['message']['from']['first_name'];
            $last_name = $data['message']['from']['last_name'];
            $text = trim($data['message']['text']);
            $text_array = explode(" ", $text);
            $bot_state = self::get_bot_state($chat_id);
        }
        if ($bot_state) {
            if ($bot_state === '/name') {
                if (strpos($text, '/') !== true) {
                    $name = new Telegram();
                    $name->name = $text;
                    $name->username = $user_name;
                    $name->user_id = $chat_id;
                    $name->save();
                    $text_return = $text . " –¥–æ–±–∞–≤–ª–µ–Ω–∏–π –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è. –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥–æ–±–∞–≤–∏—Ç–∏ —â–µ –∫–æ–≥–æ—Å—å, –ø–µ—Ä–µ–π–¥—ñ—Ç—å /name. üìù
                    
                    –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –º–æ–∂–Ω–∞ —Ç—É—Ç /list_name. üëÄ";
                }
            }
            if ($bot_state == '/delet') {
                if (strpos($text, '/') !== true) {
                    $rezult = Telegram::where('user_id', $chat_id)->where('name', $text)->delete();
                    if ($rezult) {
                        $text_return = "‚úÖ –í–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–¥–∞–ª–∏–ª–∏ $text –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è.
                        –Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —â–µ –∫–æ–≥–æ—Å—å –∑—ñ —Å–ø–∏—Å–∫—É, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è –∫–æ–º–∞–Ω–¥–æ—é /delet.

                        üìã –î–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É –ø–æ–≤–Ω–æ–≥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /list_name.";
                    } else {
                        $text_return = "–£ –≤–∞—Å –Ω–µ –±—É–ª–æ —Ç–∞–∫–æ–≥–æ —ñ–º–µ–Ω—ñ —É —Å–ø–∏—Å–∫—É";
                    }
                }
            }
            // $text_return = "–í–∫–∞–∂—ñ—Ç—å —ñ–º—è —è–∫–µ –≤–∏ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –∑—ñ —Å–ø–∏—Å–∫—É";

            file_put_contents('telegram_bot/users/' . $chat_id . '.txt', "2222");
        }
        switch ($text) {
            case '/start':
                $text_return = "–ü—Ä–∏–≤—ñ—Ç, $first_name $last_name! –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ –±–æ—Ç–∞ Event_O! ü§ñ‚ú®
                –¶—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–æ—Å—Ç—É–ø–Ω—ñ –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è:                                  
                /name - –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ —ñ–º'—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è ‚ûïüë§
                /list_name - –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –≤–µ—Å—å —Å–ø–∏—Å–æ–∫ –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è üë•üìã   
                /help - –æ—Ç—Ä–∏–º–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ üìö‚ùì
                /delet - –≤–∏–¥–∞–ª–∏—Ç–∏ —ñ–º'—è –∑—ñ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—èüóëÔ∏èüë§

                üìö –û–ø–∏—Å: Event_O - —Ü–µ —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ–¥—ñ–π —ñ –∑–º–∞–≥–∞–Ω—å. –í—ñ–Ω –¥–æ–ø–æ–º–∞–≥–∞—î –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º –±—É—Ç–∏ –≤ –∫—É—Ä—Å—ñ –æ–Ω–æ–≤–ª–µ–Ω—å —Ç–∞ –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∞–∫—Ç—É–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —É—á–∞—Å–Ω–∏–∫—ñ–≤ —Ç–∞ —ó—Ö –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è.
                üí° –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª: –ë–æ—Ç –¥–æ–∑–≤–æ–ª—è—î –¥–æ–¥–∞–≤–∞—Ç–∏ —ñ–º–µ–Ω–∞ —É—á–∞—Å–Ω–∏–∫—ñ–≤ –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è, –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —ó—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞ –º—ñ—Å—Ü–µ –≤ –∑–º–∞–≥–∞–Ω–Ω—è—Ö. –ö—Ä—ñ–º —Ç–æ–≥–æ, –≤–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–∏—Ö —ñ–º–µ–Ω —ñ –∑—Ä—É—á–Ω–æ –∫–µ—Ä—É–≤–∞—Ç–∏ —Å–ø–∏—Å–∫–æ–º –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è.                             
                –ë–∞–∂–∞—î–º–æ –≤–∞–º –ø—Ä–∏—î–º–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞–Ω–Ω—è –±–æ—Ç–æ–º Event_O —Ç–∞ —É—Å–ø—ñ—Ö—ñ–≤ —É –≤—Å—ñ—Ö –≤–∞—à—ñ—Ö –ø–æ–¥—ñ—è—Ö! üéâüåü";
                break;
            case '/help':
                $text_return = "–ü—Ä–∏–≤—ñ—Ç, $first_name $last_name! –Ø - –±–æ—Ç Event_O, —è–∫–∏–π —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –¥–ª—è –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –ø–æ–¥—ñ–π —ñ –∑–º–∞–≥–∞–Ω—å. –î–æ–∑–≤–æ–ª—å—Ç–µ –º–µ–Ω—ñ —Ä–æ–∑–ø–æ–≤—ñ—Å—Ç–∏ –≤–∞–º –ø—Ä–æ –¥–æ—Å—Ç—É–ø–Ω—ñ –∫–æ–º–∞–Ω–¥–∏:
                
                /name - —Ü—è –∫–æ–º–∞–Ω–¥–∞ –¥–æ–∑–≤–æ–ª—è—î –≤–∞–º –¥–æ–¥–∞—Ç–∏ –Ω–æ–≤–µ —ñ–º'—è –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è. –Ø –±—É–¥—É –≤—ñ–¥—Å–ª—ñ–¥–∫–æ–≤—É–≤–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –¥–ª—è –≤–∫–∞–∑–∞–Ω–æ—ó –æ—Å–æ–±–∏ —ñ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –≤–∞—Å –ø—Ä–æ —ó—Ö –æ–Ω–æ–≤–ª–µ–Ω–Ω—è. üìù‚úÖ
                
                /list_name - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ü—é –∫–æ–º–∞–Ω–¥—É, —â–æ–± –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ —ñ–º–µ–Ω, —è–∫—ñ —è –≤—ñ–¥—Å—Ç–µ–∂—É—é. –í–∏ –∑–º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ –¥–æ–¥–∞–Ω—ñ —ñ–º–µ–Ω–∞ —ñ –±—É—Ç–∏ –≤ –∫—É—Ä—Å—ñ —ó—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤. üìãüëÄ

                /delet - –≤–∏–¥–∞–ª—é —É—á–∞—Å–Ω–∏–∫ –∑—ñ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è —ñ –±—ñ–ª—å—à–µ –Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏–º—É –≤–∞—Å –ø—Ä–æ –π–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏. üóëÔ∏èüòä
       
                /help - —Ü—è –∫–æ–º–∞–Ω–¥–∞ –Ω–∞–¥–∞—Å—Ç—å –≤–∞–º –ø–æ–≤–Ω–∏–π —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∏—Ö –∫–æ–º–∞–Ω–¥ —ñ –∫–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å —ó—Ö —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—É. –í–∏ –∑–º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –æ–∑–Ω–∞–π–æ–º–∏—Ç–∏—Å—è –∑ –º–æ–∂–ª–∏–≤–æ—Å—Ç—è–º–∏ –±–æ—Ç–∞. üòäüìö
                                    
                –ù–µ —Å–æ—Ä–æ–º—Ç–µ—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ü—ñ –∫–æ–º–∞–Ω–¥–∏ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó —Ç–∞ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å–ø–∏—Å–∫–æ–º –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞–Ω–Ω—è.
                                    
                –Ø –∑–∞–≤–∂–¥–∏ —Ç—É—Ç, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ –≤–∞–º –∑ –±—É–¥—å-—è–∫–∏–º–∏ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è–º–∏ –∞–±–æ –ø–æ—Ç—Ä–µ–±–æ—é –≤ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ–π –ø—ñ–¥—Ç—Ä–∏–º—Ü—ñ. –ó–≤–µ—Ä—Ç–∞–π—Ç–µ—Å—å –¥–æ –±–æ—Ç–∞ Event_O —ñ –æ—Ç—Ä–∏–º—É–π—Ç–µ –∑—Ä—É—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –≤–∞—à—ñ —É–ª—é–±–ª–µ–Ω—ñ –ø–æ–¥—ñ—ó! üòäü§ñ";
                break;
            case '/name':
                $text_return=" üßë‚Äçüíª–î–ª—è —Ç–æ–≥–æ —â–æ–± –¥–æ–¥–∞—Ç–∏ —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–∞, –∑–∞ —è–∫–∏–º –≤–∏ —Ö–æ—á–µ—Ç–µ —Å–ª—ñ–¥–∫—É–≤–∞—Ç–∏, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à—ñ—Ç—å –π–æ–≥–æ –ø—Ä—ñ–∑–≤–∏—â–µ —Ç–∞ —ñ–º'—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –®–µ–≤—á–µ–Ω–∫–æ –¢–∞—Ä–∞—Å.";
                
                break;
            case '/delet':
                $text_return = "  üóëÔ∏è –Ø–∫—â–æ –≤–∏ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —É—á–∞—Å–Ω–∏–∫–∞ –∑—ñ —Å–ø–∏—Å–∫—É, –ø—Ä–æ—Å—Ç–æ –≤–∫–∞–∂—ñ—Ç—å –π–æ–≥–æ –ø—Ä—ñ–∑–≤–∏—â–µ —ñ–º'—è, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥: –®–µ–≤—á–µ–Ω–∫–æ –¢–∞—Ä–∞—Å.";
                break;
            case '/all_delet':
                $text_return = "–í–∏ –≤–ø–µ–≤–Ω–µ–Ω—ñ, —â–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —É—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤ –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É?

                üóëÔ∏è –¶—è –¥—ñ—è –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –ø–æ–≤–Ω–æ–≥–æ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –≤—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤, —è–∫—ñ –≤–∏ –¥–æ–¥–∞–ª–∏ –¥–æ —Å–ø–∏—Å–∫—É –≤—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è. –£—Å—ñ —ó—Ö–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Ç–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –±—É–¥—É—Ç—å –≤—Ç—Ä–∞—á–µ–Ω—ñ.
                
                –Ø–∫—â–æ –≤–∏ –ø–µ–≤–Ω—ñ —É —Å–≤–æ—î–º—É —Ä—ñ—à–µ–Ω–Ω—ñ, –≤–∏–±–µ—Ä—ñ—Ç—å –æ–¥–Ω—É –∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –æ–ø—Ü—ñ–π:
                
                /yes_delet_all - –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —É—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤.
                /no_delet_all - –≤—ñ–¥–º—ñ–Ω–∏—Ç–∏ –≤–∏–¥–∞–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ª–∏—à–∏—Ç–∏ —Å–ø–∏—Å–∫–æ–∫ –±–µ–∑ –∑–º—ñ–Ω.
                ‚ùóÔ∏è –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü—è –¥—ñ—è –Ω–µ–æ–±–æ—Ä–æ—Ç–Ω–∞ —ñ –Ω–µ –º–æ–∂–µ –±—É—Ç–∏ —Å–∫–∞—Å–æ–≤–∞–Ω–∞. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ –¥—ñ–π—Å–Ω–æ –±–∞–∂–∞—î—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ –≤—Å—ñ—Ö —Å–ø–æ—Ä—Ç—Å–º–µ–Ω—ñ–≤ –∑—ñ —Å–≤–æ–≥–æ —Å–ø–∏—Å–∫—É.
                
                –Ø–∫—â–æ —É –≤–∞—Å –≤–∏–Ω–∏–∫–ª–∏ –ø–∏—Ç–∞–Ω–Ω—è –∞–±–æ –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–æ–¥–∞—Ç–∫–æ–≤–∞ –¥–æ–ø–æ–º–æ–≥–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É /help. ü§îüí°";
                break;
            
        }


        file_put_contents('telegram_bot/users/' . $chat_id . '.txt', $text);
        return $text_return;
    }


    static function get_bot_state($chat_id)
    {
        if (file_exists('telegram_bot/users/' . $chat_id . '.txt')) {
            $data = file_get_contents('telegram_bot/users/' . $chat_id . '.txt');
            // $data = substr($data, 0, 6);
            return $data;
        } else {
            return '';
        }
    }
}
